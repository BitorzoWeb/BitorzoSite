<!DOCTYPE html><html lang="en">
<!-- Mirrored from Bitorzo/blog/contact-discovery/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 27 Aug 2020 08:06:32 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content=""><meta name="author" content=""><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="../rss.xml" /><meta property="og:title" content="The Difficulty Of Private Contact Discovery" /><meta property="og:site_name" content="Signal Messenger" /><meta property="og:type" content="website" /><meta property="og:description" content="Building a social network is not easy. Social networks have value proportional to their size, so participants aren’t motivated to join new social networks which aren’talready large. It’s a paradox where if people haven’t already joined, people aren’t motivated to join.The trouble is that while ..." /><meta property="og:url" content="index.html" /><meta property="og:image" content="../../assets/og/og-image-ff2096df535eee499356de64b19fa8cebb9681ab1e78cca7330e7f8b8d5ec6d5.png" /><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@Bitorzo"><meta name="twitter:creator" content="@Bitorzo"><meta name="twitter:url" content="index.html"><meta name="twitter:title" content="The Difficulty Of Private Contact Discovery"><meta name="twitter:description" content="Building a social network is not easy. Social networks have value proportional to their size, so participants aren’t motivated to join new social networks which aren’talready large. It’s a paradox where if people haven’t already joined, people aren’t motivated to join.The trouble is that while ..."><title>Bitorzo -  Blog >> The Difficulty Of Private Contact Discovery</title><link rel="apple-touch-icon" sizes="57x57" href="../../assets/favicon/apple-icon-57x57-1e56b07703490ebba4713a0b5ea25a03ae8d86eabc4a961158edf5b46590fd3d.png"><link rel="apple-touch-icon" sizes="60x60" href="../../assets/favicon/apple-icon-60x60-e2db2d0761f2007f5d2b1f9594a5caa49705c1221ced2472a2e471e0c53ed3fa.png"><link rel="apple-touch-icon" sizes="72x72" href="../../assets/favicon/apple-icon-72x72-97b53da0f83cc83e78f550a175abc7655b655a4ff6f8969616ccf6a45431f823.png"><link rel="apple-touch-icon" sizes="76x76" href="../../assets/favicon/apple-icon-76x76-9f2b2add20d8060fab5bda1a4fc4dbc23330e56b6ce846dc71af34b643b44294.png"><link rel="apple-touch-icon" sizes="114x114" href="../../assets/favicon/apple-icon-114x114-f6319e407b9c5379fbb0753dbf272e8d3b24a0c2e107d3c971fa173f861580bc.png"><link rel="apple-touch-icon" sizes="120x120" href="../../assets/favicon/apple-icon-120x120-c98504fda21e8555d8c527f46d170b182630953915e3f35e6be58ad7c2ba2016.png"><link rel="apple-touch-icon" sizes="144x144" href="../../assets/favicon/apple-icon-144x144-6673d278a3a610c29c506b94db1c39dbaed7316a3daa8dfa84b115d9a17a3be1.png"><link rel="apple-touch-icon" sizes="152x152" href="../../assets/favicon/apple-icon-152x152-8d0419698314ff17820aa277bc5c56df4048fff96b89d021c5e3240c804c008d.png"><link rel="apple-touch-icon" sizes="180x180" href="../../assets/favicon/apple-icon-180x180-aa2761b8418076157d993fa209969b64f3ef435dcbefb20e7f9b4ad03e6e76bd.png"><link rel="icon" type="image/png" sizes="192x192" href="../../assets/favicon/android-icon-192x192-2ce7be93a7e75de13098e18298fcb8910772ec2e035cea23f3c2ad438ff8e504.png"><link rel="icon" type="image/png" sizes="32x32" href="../../assets/favicon/favicon-32x32-382989a29cc9004cc5b4b723098a5663f944b48d4694df252b89caa831fa205f.png"><link rel="icon" type="image/png" sizes="96x96" href="../../assets/favicon/favicon-96x96-aa38de7ff5098e6c9a3a41bd2424266d64b0200d347d682292c01a1d6d402660.png"><link rel="icon" type="image/png" sizes="16x16" href="../../assets/favicon/favicon-16x16-c6d9330e8b333a3ff4dd7d9ccbfccbb22265db57ba79fd8d3f9a31a90e7d4857.png"><link rel="preload" href="../../assets/inter/Inter-Regular-c342b1b7f7d19be1429fef29bf3af6d9e8c3e21aba846e082cdee1db8a530c83.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/inter/Inter-Italic-950174d1f78a8493886d74efd89ca703e56203ea6c1564f7957180ba58048d1e.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/inter/Inter-SemiBold-af44b8a232c6946b5d4ced0df202e29f1330f66a2587b581826fd561bda24fad.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/inter/Inter-SemiBoldItalic-a4f92da5bf69f56806968b8f82b555434357608a5e9b9800fb42a2098d487980.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/inter/Inter-ExtraBold-74e72c6bbb7844899343c4783be9b4510e32951636acde44d5b4725e2132ea03.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/inter/Inter-ExtraBoldItalic-2abc7ab18591e33fbc6bfe6a6b367ad9ee5ecc5e4662ef4863600c5e786f02ea.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/fa/fa-brands-400-67ca1abd107c1c587489a06adc41ed3221a1b77048be449a076a5e93c93d2b98.woff2" as="font" crossorigin="anonymous"><link rel="manifest" href="../../assets/favicon/manifest-afc52691d6d2cefdcc79152af8efdf7848d5226b0daf713c2d6699c504fb3a75.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="../../assets/favicon/ms-icon-144x144-c87fa9bc9f7648a5dc55c8bb767caa2c9f3ff5d13dbdce9eb82e75e14ebe41d9.png"><meta name="theme-color" content="#ffffff"><link type="text/css" rel="stylesheet" href="../../assets/vendor/bulma-0.8.0.min-ccf7949cbe2c285e72f3a5c936d8abba9270e77d27b2529804ff4738dda4944e.css"><link type="text/css" rel="stylesheet" href="../../assets/ultramarine-a2815d7f3b4eb64754a6287ee073927e86f19e7f564c4aa010d62e9279e6dc07.css"><link type="text/css" rel="stylesheet" href="../../assets/vendor/fontawesome-5.4.2-6f60fac69be091431742fa23593bfdade087209c0db2bbb369913a2a4e91c252.css"><body id="signal" class="index has-navbar-fixed-top"><nav class="navbar signal-navbar is-fixed-top" role="navigation" aria-label="main navigation"><div class="container"><div class="navbar-brand"> <a href="../../index.html#signal"> <img class="signal-logo" src="../../assets/header/logo-f7ef605fe417d5520d38d546b3b774b4261c75220b9904da4d8b2ffc19a761ff.png"/> </a> <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="signalNavbar"> <span aria-hidden="true"></span> <span aria-hidden="true"></span> <span aria-hidden="true"></span> </a></div><div id="signalNavbar" class="navbar-menu"><div class="navbar-end"> <a class="navbar-item get-signal" href="../../download/index.html">Get Bitorzo</a> <a class="navbar-item" href="https://support.Bitorzo/">Support</a> <a class="navbar-item" href="../index.html">Blog</a> <a class="navbar-item" href="../../docs/index.html">Developers</a> <a class="navbar-item" href="../../workworkwork/index.html">Careers</a> <a class="navbar-item" href="../../donate/index.html">Donate</a> <a class="navbar-item" href="https://twitter.com/Bitorzo" target="_blank"><i class="fab fa-twitter"></i></a> <a class="navbar-item" href="https://instagram.com/signal_app/" target="_blank"><i class="fab fa-instagram"></i></a></div></div></div></nav><section id="post" class="section post"><article><div class="container is-centered"><div class="blog-post-header columns is-centered"><div class="column is-7"> <img class="author" src="https://avatars.githubusercontent.com/moxie0"/><h1 class="has-text-centered semibold"> The Difficulty Of Private Contact Discovery</h1><p class="body2 has-text-centered has-text-grey"> <a href="https://github.com/moxie0">moxie0</a> on 03 Jan 2014</div></div><div class="blog-post-content columns is-centered"><div class="column is-7"><p>Building a social network is not easy. Social networks have value proportional to their size, so participants aren’t motivated to join new social networks which aren’t already large. It’s a paradox where if people haven’t already joined, people aren’t motivated to join.<p>The trouble is that while building a social network is hard, most interesting software today is acutely “social.” Even privacy-enhancing technology, which seems anathema to the aesthetic of social networking, is tremendously social. For people to effectively use private communication software like TextSecure, they need to be able to know how to contact their friends using TextSecure.<p><p>Access to an existing social graph makes building social apps much easier. Traditionally, social apps turn to services like Facebook or Twitter for their social graph. By using “Facebook Connect” (sign in with Facebook) or “Twitter OAuth” (sign in with Twitter), it’s possible to write applications on top of an existing social graph (owned by Facebook or Twitter) instead of having to create a new one.<h2 id="the-mobile-graph">The Mobile Graph</h2><p>The migration towards mobile devices is in some ways a threat to the traditional monopolies of the social graph. Mobile devices feature a social graph that isn’t controlled by any single entity, and which anyone can access: the device’s “contacts.”<p>If a service uses an identifier already listed in a typical contact card (phone number or email), it’s simple to quickly display which contacts of a user are also registered with the service and immediately make social features available to that user. This means friends don’t have to “discover” each other on a service if they already have each other as contacts.<p>The problem is that the simplest way to calculate the intersection of registered users and device contacts is to upload all the contacts in the address book to the service, index them, reverse index them, send the client the intersection, and subsequently notify the client when any of those contacts later register.<p>This is not what you’d call a “privacy preserving” process. Many people are uncomfortable with their entire address book being sent to a server somewhere. Maybe they’re worried the server will spam their friends, maybe they have some sensitive contacts they don’t want to share, or maybe it just doesn’t feel right.<h2 id="solutions-that-dont-work">Solutions That Don’t Work</h2><p>Ideally we could come up with a privacy-preserving mechanism for achieving the same thing. The problem becomes: <em>How do we determine which contacts are registered with a service, without revealing the contacts to the service?</em><h3 id="hash-it">Hash It!</h3><p>The first instinct is often just to hash the contact information before sending it to the server. If the server has the SHA256 hash of every registered user, it can just check to see if those match any of the SHA256 hashes of contacts transmitted by a client.<p>Unfortunately, this doesn’t work because the “preimage space” (the set of all possible hash inputs) is small enough to easily calculate a map of all possible hash inputs to hash outputs. There are only roughly 10^10 phone numbers, and while the set of all possible email addresses is less finite, it’s still not terribly great. Inverting these hashes is basically a straightforward dictionary attack. It’s not possible to “salt” the hashes, either (they always have to match), which makes building rainbow tables possible.<h3 id="bloom-filters-and-encrypted-bloom-filters">Bloom Filters and Encrypted Bloom Filters</h3><p>There’s an entire field of study dedicated to problems like this one, known as “private information retrieval” (PIR). The simplest form of PIR is for the server to send the client the entire list of registered users, which the client can then query locally. Basically, if the client has its own copy of the entire database, it won’t leak its database queries to the server.<p>One can make this slightly more network efficient by transmitting the list of registered users in a <a href="https://en.wikipedia.org/wiki/Bloom_filter">bloom filter</a> tuned for a low false positive rate.<p>To avoid leaking the list of all registered users, it’s even possible to build a “symmetric PIR” system using “encrypted bloom filters” by doing the following:<ol><li>The server generates an RSA key pair which is kept private.<li>Rather than putting every user into a bloom filter, the server puts the RSA signature of each user into the bloom filter instead.<li>The client requests the bloom filter, which contains an RSA signature of each registered user.<li>When the client wishes to query the local bloom filter, it constructs a “blinded” query as per David Chaum’s <a href="https://en.wikipedia.org/wiki/Blind_signature">blind signature scheme</a>.<li>The client transmits the blinded query to the server.<li>The server signs the blinded query and transmits it back to the client.<li>The client <a href="https://en.wikipedia.org/wiki/Blind_signature">unblinds the query</a> to reveal the server’s RSA signature of the contact it wishes to query.<li>The client then checks its local bloom filter for that value.</ol><p>It’s also possible to compress “updates” to the bloom filter. The server just needs to calculate the XOR of the version the client has and the updated version, then run that through <a href="https://en.wikipedia.org/wiki/Lempel–Ziv–Markov_chain_algorithm">LZMA</a> (the input will be mostly zeros), and transmit the compressed diff to the client.<p>Unfortunately, for a reasonably large user base, this strategy doesn’t work because the bloom filters themselves are too large to transmit to mobile clients. For 10 million TextSecure users, a bloom filter like this would be ~40MB, requested from the server 116 times a second if every client refreshes it once a day.<h3 id="sharded-bloom-filters">Sharded Bloom Filters</h3><p>Instead of putting all registered users into a single bloom filter, one could imagine sharding the users into buckets, each of which contains a bloom filter for that shard of users.<p>This creates a privacy vs. network overhead trade-off. At one end of the spectrum, a single big bucket with all registered users in it provides perfect privacy but high network overhead: the server learns nothing when it’s requested, but has to transmit a lot. At the other end of the spectrum, many buckets, each of which contains a bloom filter with only a <em>single</em> user provides <em>zero</em> privacy but low network overhead: the server learns exactly what the full query is whenever a bucket is requested, but only has to transmit very little.<p>The hope would be that somewhere in the middle there might be an acceptable trade-off. If there were only two buckets, for instance, the client would only have to leak one bit of information to the server, but would be able to retrieve a somewhat smaller bloom filter.<p>In the end, it’s difficult to find an acceptable trade-off here. The average Android user has approximately 5000 contacts synced to their device. Ignoring the slight collision rate that kicks in with the birthday paradox, in the worst case this means the client will end up requesting 5000 different buckets. In order to make the total download size add up to something like a reasonable 2MB, this means each bucket can only represent 100 possible identifiers.<p>This basically provides very little privacy. In the case of phone numbers as an identifier, of the 100 possible numbers a client could be inquiring about in its request for a bucket, many of the 99 “other” numbers might not be active phone numbers, or might represent phone numbers located in regions where contacts of that user would be unlikely to be located.<p>In the end, this strategy seems to provide very little at the cost of fairly substantial complexity.<h3 id="that-academic-private-set-intersection-stuff">That Academic Private Set Intersection Stuff</h3><p>There are cryptographic protocols for performing privacy-preserving set intersections, but they generally involve transmitting something which represents the full set of both parties, which is a non-starter when one of the sets contains at least 10 million records.<p>The academic field of PIR is also quite a disappointment. It’s possible to improve on the network overhead of transmitting the entire data set, but generally at great computational cost. Intuitively, for the server not to learn anything about the query, it will need to at least touch every possible record in its data set when calculating a response. With a large number of users, this is potentially cost-prohibitive even if the server only needs to perform a simple operation (like XOR) for each registered user. Most PIR protocols are substantially worse, and require things like performing an RSA operation over <em>each record</em> of all registered users <em>for each client query</em>. That would translate into a client requesting that the server perform 10 million RSA operations, 5000 times!<p>This includes the small collection of protocols labeled “practical PIR,” which unfortunately don’t seem to be very practical at all. Most of them describe protocols that would take <em>minutes</em> of CPU-bound work for each client that wants to determine which of its contacts are registered users.<h2 id="an-unsolved-problem">An Unsolved Problem</h2><p>As far as we can determine, practical privacy-preserving contact discovery remains an unsolved problem.<p>For RedPhone, our user base is still manageable enough (for now) to use the bloom filter technique. For TextSecure, however, we’ve grown beyond the size where that remains practical, so the only thing we can do is write the server such that it doesn’t store the transmitted contact information, inform the user, and give them the choice of opting out.<p>This would be a great problem to really solve well. If anyone develops any insight into a practical privacy-preserving mechanism for achieving this type of contact discovery, or notices something we’ve missed, please let us know here, on <a href="https://twitter.com/Bitorzo">Twitter</a>, or <a href="https://lists.riseup.net/www/subscribe/whispersystems">on our development mailing list</a>.<p>– <a href="https://twitter.com/moxie">Moxie Marlinspike</a>, 03 January 2014<div class="social-sharing has-text-centered"><p>&nbsp;<p> <a href="https://twitter.com/intent/tweet?text=The%20Difficulty%20Of%20Private%20Contact%20Discovery&amp;url=https://Bitorzo/blog/contact-discovery/&amp;via=Bitorzo&amp;related=Bitorzo" title="Share on Twitter" target="_blank" class="btn btn-twitter"><i class="fab fa-twitter"></i> Tweet</a> <a href="https://facebook.com/sharer.php?u=https://Bitorzo/blog/contact-discovery/" rel="nofollow" title="Share on Facebook" target="_blank" class="btn btn-facebook"><i class="fab fa-facebook"></i> Facebook</a><h3 class="semibold">Want to get involved with Signal? <a href="../../workworkwork/index.html">We're hiring!</a></h3></div></div></div></div></article></section><footer class="footer"><div class="container"><div class="columns"><div class="column is-two-fifths is-hidden-mobile"> <span class="copyright">&copy; 2013&ndash;2020 Bitorzo, a 501c3 nonprofit.</span><br /> Signal is a registered trademark in the United States and other countries.</div><div class="column"> <strong>Company</strong><ul><li> <a href="../../donate/index.html">Donate</a><li> <a href="../../workworkwork/index.html">Careers</a><li> <a href="../index.html">Blog</a><li> <a href="../../legal/index.html">Terms &amp; Privacy Policy</a></ul></div><div class="column"> <strong>Download</strong><ul><li> <a href="../../download/android/index.html">Android</a><li> <a href="../../download/ios/index.html">iPhone & iPad</a><li> <a href="../../download/windows/index.html">Windows</a><li> <a href="../../download/macos/index.html">Mac</a><li> <a href="../../download/linux/index.html">Linux</a></ul></div><div class="column"> <strong>Social</strong><ul><li> <a href="https://github.com/Bitorzo" target="_blank">Github</a><li> <a href="https://twitter.com/Bitorzo" target="_blank">Twitter</a><li> <a href="https://www.instagram.com/signal_app/" target="_blank">Instagram</a></ul></div><div class="column"> <strong>Help</strong><ul><li> <a href="https://support.Bitorzo/">Support</a><li> <a href="https://community.signalusers.org/">Community</a></ul></div><div class="column is-two-fifths is-hidden-tablet"> <span class="copyright">&copy; 2013&ndash;2020 Bitorzo, a 501c3 nonprofit.</span><br /> Signal is a registered trademark in the United States and other countries.</div></div></div></footer><script type="text/javascript" src="../../assets/vendor/jquery-3.5.1.min-a6ed45d15e46615f8c15931ca254e398a912e770b10122a4435529a1a523180d.js"></script> <script type="text/javascript" src="../../assets/vendor/lottie-player-0.5.1.min-7b15c2adfdb246be3414fb8d6966f54c06cc82f090a5d23c77f079de4c16fef3.js"></script> <script type="text/javascript"> const $langSelectors = Array.prototype.slice.call(document.querySelectorAll('a[data-lang]')); $langSelectors.forEach((el) => { el.addEventListener('click', (ev) => { const lang = ev.getAttribute('data-lang'); if (lang) { document.cookie = 'selected_language=' + lang + '; samesite; secure; path=/; max-age=7776000;'; } }); }); document.addEventListener('DOMContentLoaded', () => { var userAgent = navigator.userAgent.toLowerCase(); var isIOS = ( userAgent.indexOf('iphone') !== -1 || userAgent.indexOf('ipad') !== -1 || userAgent.indexOf('ipod') !== -1 ); var isAndroid = userAgent.indexOf('android') !== -1; var $downloadSignal = $('.get-signal'); if (isIOS || isAndroid) { var url = isIOS ? 'https://play.google.com/store/apps/details?id=com.bitorzo.wallet' : 'https://play.google.com/store/apps/details?id=org.thoughtcrime.securesms'; $downloadSignal.prop('href', url); $downloadSignal.html('<span>Get Bitorzo</span> <i class="fas fa-external-link-alt"></i>'); } const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger')); if ($navbarBurgers.length > 0) { $navbarBurgers.forEach((el) => { el.addEventListener('click', () => { const target = el.dataset.target; const $target = document.getElementById(target); el.classList.toggle('is-active'); $target.classList.toggle('is-active'); }); }); } }); </script> <script type="text/javascript"> var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101071404); (function() { var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://static.getclicky.com/js'; ( document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0] ).appendChild( s ); })(); </script> <noscript><p><img width="1" height="1" src="../../../in.getclicky.com/101071404ns.gif" /></noscript>
