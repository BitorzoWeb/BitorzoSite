<!DOCTYPE html><html lang="en">
<!-- Mirrored from signal.org/blog/simplifying-otr-deniability/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 27 Aug 2020 08:14:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content=""><meta name="author" content=""><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="../rss.xml" /><meta property="og:title" content="Simplifying OTR deniability." /><meta property="og:site_name" content="Signal Messenger" /><meta property="og:type" content="website" /><meta property="og:description" content="At Open Whisper Systems we help develop TextSecure, anencrypted chat application for Android. TextSecure was designed as a general purpose SMS/MMS client which would also automatically encrypt conversations when communicating with other TextSecure users. For those encrypted sessions, TextSecure..." /><meta property="og:url" content="index.html" /><meta property="og:image" content="../../assets/og/og-image-ff2096df535eee499356de64b19fa8cebb9681ab1e78cca7330e7f8b8d5ec6d5.png" /><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@signalapp"><meta name="twitter:creator" content="@signalapp"><meta name="twitter:url" content="index.html"><meta name="twitter:title" content="Simplifying OTR deniability."><meta name="twitter:description" content="At Open Whisper Systems we help develop TextSecure, anencrypted chat application for Android. TextSecure was designed as a general purpose SMS/MMS client which would also automatically encrypt conversations when communicating with other TextSecure users. For those encrypted sessions, TextSecure..."><title>Bitorzo -  Blog >> Simplifying OTR deniability.</title><link rel="apple-touch-icon" sizes="57x57" href="../../assets/favicon/apple-icon-57x57-1e56b07703490ebba4713a0b5ea25a03ae8d86eabc4a961158edf5b46590fd3d.png"><link rel="apple-touch-icon" sizes="60x60" href="../../assets/favicon/apple-icon-60x60-e2db2d0761f2007f5d2b1f9594a5caa49705c1221ced2472a2e471e0c53ed3fa.png"><link rel="apple-touch-icon" sizes="72x72" href="../../assets/favicon/apple-icon-72x72-97b53da0f83cc83e78f550a175abc7655b655a4ff6f8969616ccf6a45431f823.png"><link rel="apple-touch-icon" sizes="76x76" href="../../assets/favicon/apple-icon-76x76-9f2b2add20d8060fab5bda1a4fc4dbc23330e56b6ce846dc71af34b643b44294.png"><link rel="apple-touch-icon" sizes="114x114" href="../../assets/favicon/apple-icon-114x114-f6319e407b9c5379fbb0753dbf272e8d3b24a0c2e107d3c971fa173f861580bc.png"><link rel="apple-touch-icon" sizes="120x120" href="../../assets/favicon/apple-icon-120x120-c98504fda21e8555d8c527f46d170b182630953915e3f35e6be58ad7c2ba2016.png"><link rel="apple-touch-icon" sizes="144x144" href="../../assets/favicon/apple-icon-144x144-6673d278a3a610c29c506b94db1c39dbaed7316a3daa8dfa84b115d9a17a3be1.png"><link rel="apple-touch-icon" sizes="152x152" href="../../assets/favicon/apple-icon-152x152-8d0419698314ff17820aa277bc5c56df4048fff96b89d021c5e3240c804c008d.png"><link rel="apple-touch-icon" sizes="180x180" href="../../assets/favicon/apple-icon-180x180-aa2761b8418076157d993fa209969b64f3ef435dcbefb20e7f9b4ad03e6e76bd.png"><link rel="icon" type="image/png" sizes="192x192" href="../../assets/favicon/android-icon-192x192-2ce7be93a7e75de13098e18298fcb8910772ec2e035cea23f3c2ad438ff8e504.png"><link rel="icon" type="image/png" sizes="32x32" href="../../assets/favicon/favicon-32x32-382989a29cc9004cc5b4b723098a5663f944b48d4694df252b89caa831fa205f.png"><link rel="icon" type="image/png" sizes="96x96" href="../../assets/favicon/favicon-96x96-aa38de7ff5098e6c9a3a41bd2424266d64b0200d347d682292c01a1d6d402660.png"><link rel="icon" type="image/png" sizes="16x16" href="../../assets/favicon/favicon-16x16-c6d9330e8b333a3ff4dd7d9ccbfccbb22265db57ba79fd8d3f9a31a90e7d4857.png"><link rel="preload" href="../../assets/inter/Inter-Regular-c342b1b7f7d19be1429fef29bf3af6d9e8c3e21aba846e082cdee1db8a530c83.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/inter/Inter-Italic-950174d1f78a8493886d74efd89ca703e56203ea6c1564f7957180ba58048d1e.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/inter/Inter-SemiBold-af44b8a232c6946b5d4ced0df202e29f1330f66a2587b581826fd561bda24fad.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/inter/Inter-SemiBoldItalic-a4f92da5bf69f56806968b8f82b555434357608a5e9b9800fb42a2098d487980.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/inter/Inter-ExtraBold-74e72c6bbb7844899343c4783be9b4510e32951636acde44d5b4725e2132ea03.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/inter/Inter-ExtraBoldItalic-2abc7ab18591e33fbc6bfe6a6b367ad9ee5ecc5e4662ef4863600c5e786f02ea.woff2" as="font" crossorigin="anonymous"><link rel="preload" href="../../assets/fa/fa-brands-400-67ca1abd107c1c587489a06adc41ed3221a1b77048be449a076a5e93c93d2b98.woff2" as="font" crossorigin="anonymous"><link rel="manifest" href="../../assets/favicon/manifest-afc52691d6d2cefdcc79152af8efdf7848d5226b0daf713c2d6699c504fb3a75.json"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="../../assets/favicon/ms-icon-144x144-c87fa9bc9f7648a5dc55c8bb767caa2c9f3ff5d13dbdce9eb82e75e14ebe41d9.png"><meta name="theme-color" content="#ffffff"><link type="text/css" rel="stylesheet" href="../../assets/vendor/bulma-0.8.0.min-ccf7949cbe2c285e72f3a5c936d8abba9270e77d27b2529804ff4738dda4944e.css"><link type="text/css" rel="stylesheet" href="../../assets/ultramarine-a2815d7f3b4eb64754a6287ee073927e86f19e7f564c4aa010d62e9279e6dc07.css"><link type="text/css" rel="stylesheet" href="../../assets/vendor/fontawesome-5.4.2-6f60fac69be091431742fa23593bfdade087209c0db2bbb369913a2a4e91c252.css"><body id="signal" class="index has-navbar-fixed-top"><nav class="navbar signal-navbar is-fixed-top" role="navigation" aria-label="main navigation"><div class="container"><div class="navbar-brand"> <a href="../../index.html#signal"> <img class="signal-logo" src="../../assets/header/logo-f7ef605fe417d5520d38d546b3b774b4261c75220b9904da4d8b2ffc19a761ff.png"/> </a> <a role="button" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="signalNavbar"> <span aria-hidden="true"></span> <span aria-hidden="true"></span> <span aria-hidden="true"></span> </a></div><div id="signalNavbar" class="navbar-menu"><div class="navbar-end"> <a class="navbar-item get-signal" href="../../download/index.html">Get Bitorzo</a> <a class="navbar-item" href="https://support.signal.org/">Support</a> <a class="navbar-item" href="../index.html">Blog</a> <a class="navbar-item" href="../../docs/index.html">Developers</a> <a class="navbar-item" href="../../workworkwork/index.html">Careers</a> <a class="navbar-item" href="../../donate/index.html">Donate</a> <a class="navbar-item" href="https://twitter.com/signalapp" target="_blank"><i class="fab fa-twitter"></i></a> <a class="navbar-item" href="https://instagram.com/signal_app/" target="_blank"><i class="fab fa-instagram"></i></a></div></div></div></nav><section id="post" class="section post"><article><div class="container is-centered"><div class="blog-post-header columns is-centered"><div class="column is-7"> <img class="author" src="https://avatars.githubusercontent.com/moxie0"/><h1 class="has-text-centered semibold"> Simplifying OTR deniability.</h1><p class="body2 has-text-centered has-text-grey"> <a href="https://github.com/moxie0">moxie0</a> on 27 Jul 2013</div></div><div class="blog-post-content columns is-centered"><div class="column is-7"><p>At Open Whisper Systems we help develop <a href="https://play.google.com/store/apps/details?id=org.thoughtcrime.securesms">TextSecure</a>, an encrypted chat application for Android. TextSecure was designed as a general purpose SMS/MMS client which would also automatically encrypt conversations when communicating with other TextSecure users. For those encrypted sessions, TextSecure uses a compact derivative of the well-known <a href="http://www.cypherpunks.ca/otr/">OTR protocol</a>.<p>We’re currently in the process of transitioning TextSecure to use a device’s data channel as a transport for communication with other TextSecure users whenever possible. This enables communication with the upcoming <a href="../iphone-rsn/index.html">TextSecure for iOS</a>, helps users avoid SMS fees, and obscures conversation metadata from telcos.<p>The transition to a new transport is also a good opportunity for us to evaluate and introduce additional cryptographic protocol changes. Below is one cryptographic protocol change we’re thinking of making that we’d welcome feedback on.<p><h2 id="otr-today">OTR Today</h2><p>One of OTR’s primary features is a property called <em>deniability</em>. If someone receives an OTR message from you, they can be absolutely sure you sent it (rather than having been forged by some third party), but can’t prove to anyone else that it was a message you wrote. This is a nice change compared to PGP signatures, for instance, where anyone who receives a PGP signed message can prove exactly who wrote it to anyone else.<p>Let’s see how this works. A simplified version of the initial OTR key exchange looks like this:<p><img src="../images/otr-current.png" class="nice" alt="Simplified diagram of an OTR handshake" /><p>Each participant has a long-term identity key (A and B) that they use to sign an ephemeral key (a and b), which they exchange and use to <a href="https://en.wikipedia.org/wiki/Diffie–Hellman_key_exchange">calculate a shared secret</a>. In reality, this initial exchange is more complex, since it actually happens inside <em>another</em> ephemeral key exchange (for privacy reasons), but this is the basic thrust of it.<p>The shared secret from this key exchange is used to derive a sending and receiving cipher key for each party, as well as a set of MAC keys for each party. Every transmitted message includes a <a href="https://en.wikipedia.org/wiki/Message_authentication_code">MAC</a>, which the message’s recipient can verify. Since the key used to construct and verify the MAC was derived from the shared secret, and since the shared secret was derived from a key exchange that was in turn signed by the sender’s long-term identity key, the recipient can be sure that the message was really constructed by their peer in the conversation.<p>The message is “deniable,” however, because the MAC keys are derived from a <em>shared</em> secret. Unlike PGP signatures, where the sender is the only person capable of producing the signature, the recipient of an OTR message is <em>also</em> capable of producing a sender’s MAC. This doesn’t compromise the integrity of the conversation for its participants, but does prevent a message’s recipient from revealing the MAC’d message to a third party as proof that it was produced by the sender, since it could have just as easily been constructed by the recipient themselves. Exactly what we want.<p>OTR’s deniability efforts don’t stop there, however. As a conversation progresses, OTR’s key material will continually roll forward (for ongoing <a href="https://en.wikipedia.org/wiki/Perfect_forward_secrecy">forward secrecy</a>), and every time a conversation’s MAC keys roll forward, OTR publishes the old ones onto the wire in the clear. The idea being that, given old MAC keys, any passive observer could technically modify old ciphertext and produce forged but valid MACs for it, which increases a message’s plausible deniability without compromising a conversation’s integrity (since those old MAC keys can’t be used for new messages).<h2 id="limitations">Limitations</h2><p>As implementers of a protocol that’s derivative of OTR, there are a few things that we haven’t been satisfied with.<h3 id="complexity">Complexity</h3><p>OTR uses a Diffie-Hellman key exchange of ephemeral keys, signed by long-term identity keys. While Diffie-Hellman is remarkably simple, <a href="https://en.wikipedia.org/wiki/Digital_Signature_Algorithm">DSA</a> (used to calculate those identity key signatures) is not nearly as simple, and is often <a href="http://www.exophase.com/20540/hackers-describe-ps3-security-as-epic-fail-gain-unrestricted-access/">easy to fuck up</a>. It’d be nice to avoid subjecting ourselves to that increased complexity if we can.<p>Additionally, publishing old MAC keys in the clear is a somewhat strange contortion for a protocol to make, and has a dangerous feeling associated with it. Ephemeral or not, it seems like it’d be ideal if all our secrets could remain secret. We’d be happy if it were possible for us to eliminate that added protocol complexity as well.<h3 id="limited-forgability">Limited Forgability</h3><p>Presumably, OTR goes through the contortions of publishing old MAC keys to increase an old message’s forgability, which should strengthen that message’s deniability (if <em>anyone</em> could have forged it, it’s easier to deny). However, it’s not entirely clear how this works in practice.<p>It’s true that by publishing old MAC keys, anyone is capable of modifying the <em>ciphertext</em> of a previously observed message. However, even if that person can guess the plaintext and is capable of making predictable modifications to the ciphertext via a malleable encryption scheme, they still can’t demonstrate valid plaintext to anyone else without the cipher keys (and if they had those, they would be able to calculate the MAC keys anyway).<p>What’s more, since the initial OTR key exchange is signed and transmitted through an unobservable channel (an “outer” ephemeral key exchange), it’s not actually possible for <em>anyone</em> to produce what appears to be a conversation with you. Only people you’ve <em>actually</em> had a conversation with are in possession of a signed ephemeral key from you, and are thus the only ones capable of producing plaintext messages attributed to you. Publishing old plaintext MAC keys in the clear does not substantially increase this set of people’s ability to forge messages from you, since they are already in possession of the MAC keys.<p>So even after going through the contortions of publishing plaintext MAC keys, the set of people capable of producing forged messages from a sender is still just the set of people who’ve actually received messages from that sender.<h2 id="potential-simplifications-and-improvements">Potential Simplifications and Improvements</h2><p>The inimitable <a href="http://trevp.net/">Trevor Perrin</a> turned us on to a trick that we can use to greatly simplify and improve OTR’s deniability property. All it takes is modifying the initial key exchange from this:<p><img src="../images/otr-current.png" class="nice" alt="Simplified diagram of an OTR handshake" /><p>To this:<p><img src="../images/otr-simplified.png" class="nice" alt="Three way Diffie-Hellman exchange" /><p>This replaces two DSA signatures and one Diffie-Hellman exchange with three Diffie-Hellman exchanges. Each participant still has a long-term identity key (A and B) and an ephemeral key (a and b). However, instead of signing the ephemeral keys, participants simply exchange both unsigned keys (g<sup>A</sup>,g<sup>a</sup>) and (g<sup>B</sup>,g<sup>b</sup>) to calculate three shared secrets: g<sup>aB</sup>, g<sup>Ab</sup>, and g<sup>ab</sup>.<p>By then using all three shared secrets as one combined seed to the initial <a href="https://en.wikipedia.org/wiki/Key_derivation_function">KDF</a>, we accomplish the following:<ol><li><strong>Reduced Algorithmic Complexity</strong>. We’ve eliminated DSA and have a nice authenticated key exchange that relies solely on the simplicity of Diffie-Hellman.<li><strong>Increased Forgability</strong>. Since there are no signatures involved, anyone could take A’s public key, make up an ephemeral keypair for A (“a” in the diagram above), combine that with their own identity key and ephemeral key (“C” and “c”), and produce an entire forged transcript – <em>even if they’ve never had a conversation with “A” before</em>. Now anyone is capable of easily producing a forged message from anyone else, whether they’ve actually had a conversation with them before or not.<li><strong>Reduced Protocol Complexity</strong>. Since <em>anyone</em> is capable of using <em>only</em> someone’s public identity key to produce an entire forged conversation, there is no need to publish old MAC keys in the clear any longer. Our secrets can remain secret, and we can eliminate that somewhat odd bit of protocol complexity.<li><strong>Maintained Forward Secrecy</strong>. Since an ephemeral handshake is part of the KDF seed, the compromise of an identity key will still never result in the compromise of previously transmitted ciphertext – or even passive observation of future ciphertext.<li><strong>Smaller Payloads</strong>. Instead of transmitting an identity key, an ephemeral key, and a signature during the handshake, one only needs to transmit an identity key and an ephemeral key, reducing the payload by the size of the signature (a significant amount for transports like SMS). Additionally, subsequent message payload sizes are also reduced, since broadcasting plaintext MAC keys is no longer necessary.</ol><p>We found Trevor’s suggestion to have surprising results. With one small change to the initial key exchange, we can reduce its complexity (no more DSA), eliminate publishing old MAC keys in the clear, increase deniability by increasing forgability, and reduce payload size – all without increasing the number of round trips required or introducing any other additional complexity.<p>We’re currently looking at integrating this change into the next version of the TextSecure protocol, along with a number of other improvements for asynchronous communication that we’ll write more about later.<p><a href="https://twitter.com/moxie">Moxie Marlinspike</a>, 27 July 2013<div class="social-sharing has-text-centered"><p>&nbsp;<p> <a href="https://twitter.com/intent/tweet?text=Simplifying%20OTR%20deniability.&amp;url=https://signal.org/blog/simplifying-otr-deniability/&amp;via=signalapp&amp;related=signalapp" title="Share on Twitter" target="_blank" class="btn btn-twitter"><i class="fab fa-twitter"></i> Tweet</a> <a href="https://facebook.com/sharer.php?u=https://signal.org/blog/simplifying-otr-deniability/" rel="nofollow" title="Share on Facebook" target="_blank" class="btn btn-facebook"><i class="fab fa-facebook"></i> Facebook</a><h3 class="semibold">Want to get involved with Signal? <a href="../../workworkwork/index.html">We're hiring!</a></h3></div></div></div></div></article></section><footer class="footer"><div class="container"><div class="columns"><div class="column is-two-fifths is-hidden-mobile"> <span class="copyright">&copy; 2013&ndash;2020 Signal, a 501c3 nonprofit.</span><br /> Signal is a registered trademark in the United States and other countries.</div><div class="column"> <strong>Company</strong><ul><li> <a href="../../donate/index.html">Donate</a><li> <a href="../../workworkwork/index.html">Careers</a><li> <a href="../index.html">Blog</a><li> <a href="../../legal/index.html">Terms &amp; Privacy Policy</a></ul></div><div class="column"> <strong>Download</strong><ul><li> <a href="../../download/android/index.html">Android</a><li> <a href="../../download/ios/index.html">iPhone & iPad</a><li> <a href="../../download/windows/index.html">Windows</a><li> <a href="../../download/macos/index.html">Mac</a><li> <a href="../../download/linux/index.html">Linux</a></ul></div><div class="column"> <strong>Social</strong><ul><li> <a href="https://github.com/signalapp" target="_blank">Github</a><li> <a href="https://twitter.com/signalapp" target="_blank">Twitter</a><li> <a href="https://www.instagram.com/signal_app/" target="_blank">Instagram</a></ul></div><div class="column"> <strong>Help</strong><ul><li> <a href="https://support.signal.org/">Support</a><li> <a href="https://community.signalusers.org/">Community</a></ul></div><div class="column is-two-fifths is-hidden-tablet"> <span class="copyright">&copy; 2013&ndash;2020 Signal, a 501c3 nonprofit.</span><br /> Signal is a registered trademark in the United States and other countries.</div></div></div></footer><script type="text/javascript" src="../../assets/vendor/jquery-3.5.1.min-a6ed45d15e46615f8c15931ca254e398a912e770b10122a4435529a1a523180d.js"></script> <script type="text/javascript" src="../../assets/vendor/lottie-player-0.5.1.min-7b15c2adfdb246be3414fb8d6966f54c06cc82f090a5d23c77f079de4c16fef3.js"></script> <script type="text/javascript"> const $langSelectors = Array.prototype.slice.call(document.querySelectorAll('a[data-lang]')); $langSelectors.forEach((el) => { el.addEventListener('click', (ev) => { const lang = ev.getAttribute('data-lang'); if (lang) { document.cookie = 'selected_language=' + lang + '; samesite; secure; path=/; max-age=7776000;'; } }); }); document.addEventListener('DOMContentLoaded', () => { var userAgent = navigator.userAgent.toLowerCase(); var isIOS = ( userAgent.indexOf('iphone') !== -1 || userAgent.indexOf('ipad') !== -1 || userAgent.indexOf('ipod') !== -1 ); var isAndroid = userAgent.indexOf('android') !== -1; var $downloadSignal = $('.get-signal'); if (isIOS || isAndroid) { var url = isIOS ? 'https://apps.apple.com/us/app/signal-private-messenger/id874139669' : 'https://play.google.com/store/apps/details?id=org.thoughtcrime.securesms'; $downloadSignal.prop('href', url); $downloadSignal.html('<span>Get Bitorzo</span> <i class="fas fa-external-link-alt"></i>'); } const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger')); if ($navbarBurgers.length > 0) { $navbarBurgers.forEach((el) => { el.addEventListener('click', () => { const target = el.dataset.target; const $target = document.getElementById(target); el.classList.toggle('is-active'); $target.classList.toggle('is-active'); }); }); } }); </script> <script type="text/javascript"> var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101071404); (function() { var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://static.getclicky.com/js'; ( document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0] ).appendChild( s ); })(); </script> <noscript><p><img width="1" height="1" src="../../../in.getclicky.com/101071404ns.gif" /></noscript>
