(window.webpackJsonp=window.webpackJsonp||[]).push([[355],{"./blocks/site-icon/index.jsx":function(e,t,s){"use strict";var r=s("../node_modules/prop-types/index.js"),n=s.n(r),i=s("../node_modules/react/index.js"),a=s.n(i),o=s("../node_modules/react-redux/es/index.js"),c=s("../node_modules/lodash-es/get.js"),u=s("../node_modules/classnames/index.js"),l=s.n(u),d=s("./components/gridicon/index.tsx"),m=s("./components/image/index.js"),j=s("./my-sites/media-library/media-image.tsx"),b=s("./components/spinner/index.jsx"),f=s("./components/data/query-sites/index.jsx"),p=s("./state/sites/selectors/get-site.js"),g=s("./state/selectors/get-site-icon-id.js"),v=s("./state/selectors/get-site-icon-url.js"),h=s("./state/selectors/get-media-item.js");function O(e,t,s){return!!Object(c.a)(Object(h.a)(e,t,s),"transient")}var y=s("./lib/resize-image-url/index.js");s("./blocks/site-icon/style.scss");function x(e){var t=e.siteId,s=e.site,r=e.iconUrl,n=e.size,i=e.imgSize,o=e.isTransientIcon,c=Object(y.a)(r,i),u=l()("site-icon",{"is-blank":!c,"is-transient":o}),p={height:n,width:n,lineHeight:n+"px",fontSize:n+"px"};return a.a.createElement("div",{className:u,style:p},!s&&t>0&&a.a.createElement(f.a,{siteId:t}),c?a.a.createElement(j.a,{component:m.a,className:"site-icon__img",src:c,alt:""}):a.a.createElement(d.a,{icon:"site",size:Math.round(n/1.3)}),o&&a.a.createElement(b.a,null))}x.propTypes={siteId:n.a.number,site:n.a.object,iconUrl:n.a.string,size:n.a.number,imgSize:n.a.number,isTransientIcon:n.a.bool},x.defaultProps={imgSize:120,size:32};t.a=Object(o.c)((function(e,t){var s=t.site,r=t.siteId,n=t.imgSize,i=Object(p.a)(e,Object(c.a)(s,"ID",r));if(!i)return{iconUrl:Object(c.a)(s,"icon.img")};var a=Object(g.a)(e,i.ID);return{site:i,iconUrl:Object(v.a)(e,i.ID,n),isTransientIcon:O(e,i.ID,a)}}))(x)},"./blocks/site-icon/style.scss":function(e,t,s){},"./components/image-preloader/index.tsx":function(e,t,s){"use strict";s.d(t,"a",(function(){return j}));var r,n=s("../node_modules/@babel/runtime/helpers/extends.js"),i=s.n(n),a=s("../node_modules/@babel/runtime/helpers/slicedToArray.js"),o=s.n(a),c=s("../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),u=s.n(c),l=s("../node_modules/react/index.js"),d=s.n(l),m=s("../node_modules/lodash-es/noop.js");function j(e){var t,s=e.children,n=e.src,a=e.placeholder,c=e.onLoad,j=e.onError,b=u()(e,["children","src","placeholder","onLoad","onError"]),f=Object(l.useState)(r.PENDING),p=o()(f,2),g=p[0],v=p[1],h=Object(l.useRef)(null),O=Object(l.useRef)(c),y=Object(l.useRef)(j);switch(Object(l.useEffect)((function(){O.current=c,y.current=j}),[j,c]),Object(l.useEffect)((function(){if(v(r.LOADING),n)return h.current=new Image,h.current.src=n,h.current.onload=t,h.current.onerror=t,e;function e(){h.current&&(h.current.onload=m.a,h.current.onerror=m.a,h.current=null)}function t(t){if(e(),!t||"load"!==t.type)return v(r.FAILED),void(y.current&&y.current(t));v(r.LOADED),O.current&&O.current(t)}}),[n]),g){case r.LOADING:t=a;break;case r.LOADED:t=d.a.createElement("img",i()({src:n},b));break;case r.FAILED:t=s}return d.a.createElement("div",{className:"image-preloader"},t)}!function(e){e[e.PENDING=0]="PENDING",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED",e[e.FAILED=3]="FAILED"}(r||(r={}))},"./components/image/index.js":function(e,t,s){"use strict";s.d(t,"a",(function(){return _}));var r=s("../node_modules/@babel/runtime/helpers/extends.js"),n=s.n(r),i=s("../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(i),o=s("../node_modules/@babel/runtime/helpers/classCallCheck.js"),c=s.n(o),u=s("../node_modules/@babel/runtime/helpers/createClass.js"),l=s.n(u),d=s("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),m=s.n(d),j=s("../node_modules/@babel/runtime/helpers/inherits.js"),b=s.n(j),f=s("../node_modules/@babel/runtime/helpers/createSuper.js"),p=s.n(f),g=s("../node_modules/@babel/runtime/helpers/defineProperty.js"),v=s.n(g),h=s("../node_modules/react/index.js"),O=s.n(h),y=s("../node_modules/classnames/index.js"),x=s.n(y),_=(s("./components/image/style.scss"),function(e){b()(s,e);var t=p()(s);function s(){var e;c()(this,s);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return e=t.call.apply(t,[this].concat(n)),v()(m()(e),"state",{isError:!1}),v()(m()(e),"handleError",(function(){e.setState({isError:!0})})),e}return l()(s,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.src!==this.props.src&&this.setState({isError:!1})}},{key:"render",value:function(){var e=this.props,t=e.className,s=a()(e,["className"]),r=x()(t,{image:!0,"is-error":this.state.isError});return O.a.createElement("img",n()({onError:this.handleError,className:r},s))}}]),s}(h.Component));v()(_,"defaultProps",{className:""})},"./components/image/style.scss":function(e,t,s){},"./lib/resize-image-url/index.js":function(e,t,s){"use strict";s.d(t,"a",(function(){return b}));var r,n=s("../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),i=s.n(n),a=s("../node_modules/lodash-es/mapValues.js"),o=s("./lib/safe-image-url/index.js"),c=s("./lib/url/url-parts.ts"),u=/^https?:$/,l="undefined"!=typeof window&&(null===(r=window)||void 0===r?void 0:r.devicePixelRatio)>1?2:1,d=["w","h","resize","fit","s"],m={photon:/(^[is]\d\.wp\.com|(^|\.)wordpress\.com)$/,gravatar:/(^|\.)gravatar\.com$/},j=function(e){return e*l};function b(e,t,s){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if("string"!=typeof e)return e;var n=Object(c.b)(e),l=(n.search,i()(n,["search"]));if(!u.test(l.protocol))return e;if(!l.hostname)return e;d.forEach((function(e){return l.searchParams.delete(e)}));var f=Object.keys(m).find((function(e){return l.hostname.match(m[e])}));if("number"==typeof t&&(t="gravatar"===f?{s:t}:s>0?{fit:[t,s].join()}:{w:t}),!f&&r)return b(Object(o.a)(e),t,null,!1);for(var p=Object(a.a)(t,(function(e,t){return"resize"===t||"fit"===t?e.split(",").map(j).join(","):d.includes(t)?j(e):e})),g=0,v=Object.keys(p);g<v.length;g++){var h=v[g];l.searchParams.set(h,p[h])}return Object(c.a)(l).href}},"./my-sites/media-library/media-file.tsx":function(e,t,s){"use strict";var r=s("../node_modules/@babel/runtime/helpers/extends.js"),n=s.n(r),i=s("../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),a=s.n(i),o=s("../node_modules/react/index.js"),c=s.n(o),u=s("../node_modules/react-redux/es/index.js"),l=s("./state/selectors/is-private-site.ts"),d=s("./state/selectors/is-site-automated-transfer.js"),m=s("./state/ui/selectors/get-selected-site-id.js"),j=s("./state/ui/selectors/get-selected-site-slug.js"),b=s("../node_modules/@babel/runtime/helpers/slicedToArray.js"),f=s.n(b),p=s("../node_modules/debug/src/browser.js"),g=s.n(p),v=s("./lib/wp/browser.js"),h=g()("calypso:my-sites:media-library:proxied-image"),O=(globalThis.Blob,{}),y=function(e){var t=e.siteSlug,s=e.filePath,r=e.query,i=e.placeholder,u=e.maxSize,l=e.onError,d=e.component,m=a()(e,["siteSlug","filePath","query","placeholder","maxSize","onError","component"]),j=Object(o.useState)(""),b=f()(j,2),p=b[0],g=b[1],y="media-library-proxied-image-".concat(t).concat(s).concat(r);return Object(o.useEffect)((function(){if(!p)if(O[y]){var e=URL.createObjectURL(O[y]);g(e),h("set image from cache",{url:e})}else{h("requesting image from API",{requestId:y,imageObjectUrl:p});var n={query:r};null!==u&&(n.maxSize=u),v.a.undocumented().getAtomicSiteMediaViaProxyRetry(t,s,n).then((function(e){!function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e4,r=Object.keys(O);r.length>100&&delete O[r[0]],O[e]=t,setTimeout((function(){delete O[e]}),s)}(y,e),g(URL.createObjectURL(e)),h("got image from API",{requestId:y,imageObjectUrl:p,data:e})})).catch(l)}return function(){p&&(h("Cleared blob from memory on dismount: "+p),URL.revokeObjectURL(p))}}),[s,y,t]),p?c.a.createElement(d,n()({src:p},m)):i};y.defaultProps={placeholder:null};var x=y,_=s("../node_modules/@babel/runtime/helpers/toArray.js"),I=s.n(_),E=s("./lib/url/url-parts.ts");var S=function(e){var t=e.src,s=e.query,r=e.filePath,i=e.siteSlug,o=e.useProxy,u=void 0!==o&&o,l=e.placeholder,d=void 0===l?null:l,m=e.maxSize,j=(e.dispatch,e.component),b=e.proxiedComponent,f=a()(e,["src","query","filePath","siteSlug","useProxy","placeholder","maxSize","dispatch","component","proxiedComponent"]);return u?c.a.createElement(x,n()({siteSlug:i,filePath:r,query:s,component:b||j,placeholder:d,maxSize:m},f)):c.a.createElement(j,n()({src:t},f))};S.defaultProps={placeholder:null,component:"img"};t.a=Object(u.c)((function(e,t){var s=t.src,r=Object(m.a)(e),n=Object(j.a)(e),i=!!Object(d.a)(e,r),a=!!Object(l.a)(e,r),o=function(e,t){var s=Object(E.b)(e),r=s.pathname,n=s.search,i=s.protocol,a=s.hostname,o=r,c=!0;if(-1===["http:","https:"].indexOf(i))c=!1;else if(a!==t&&(c=!1,/^i[0-2]\.wp\.com$/.test(a))){var u=o.substr(1).split("/"),l=I()(u),d=l[0];o="/"+l.slice(1).join("/"),d===t&&(c=!0)}return{query:n,filePath:o,isRelativeToSiteRoot:c}}(s,n),c=o.filePath,u=o.query,b=o.isRelativeToSiteRoot;return{query:u,siteSlug:n,useProxy:i&&a&&c&&b,filePath:c}}))(S)},"./my-sites/media-library/media-image.tsx":function(e,t,s){"use strict";var r=s("../node_modules/@babel/runtime/helpers/extends.js"),n=s.n(r),i=s("../node_modules/react/index.js"),a=s.n(i),o=s("./components/image-preloader/index.tsx"),c=s("./my-sites/media-library/media-file.tsx"),u=function(e){var t=e.component;return"img"===t&&e.placeholder&&(t=o.a),a.a.createElement(c.a,n()({},e,{component:t}))};u.defaultProps={component:"img",proxiedComponent:"img"},t.a=u},"./state/selectors/get-media-item.js":function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s("../node_modules/lodash-es/isNil.js");var n=s("./state/selectors/get-media-query-manager.js");function i(e,t,s){var i,a=function(e,t,s){var r,n,i,a;return null==e||null===(r=e.media)||void 0===r||null===(n=r.transientItems)||void 0===n||null===(i=n[t])||void 0===i||null===(a=i.transientItems)||void 0===a?void 0:a[s]}(e,t,s);if(!Object(r.a)(a))return a;var o=null!==(i=function(e,t,s){var r,n,i,a;return null==e||null===(r=e.media)||void 0===r||null===(n=r.transientItems)||void 0===n||null===(i=n[t])||void 0===i||null===(a=i.transientIdsToServerIds)||void 0===a?void 0:a[s]}(e,t,s))&&void 0!==i?i:s,c=Object(n.a)(e,t);if(!c)return null;var u=c.getItem(o)||null;return null===u?null:u.URL?u:null}},"./state/selectors/get-media-query-manager.js":function(e,t,s){"use strict";function r(e,t){var s,r;return null!==(s=null===(r=e.media.queries)||void 0===r?void 0:r[t])&&void 0!==s?s:null}s.d(t,"a",(function(){return r}))},"./state/selectors/get-site-icon-id.js":function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var r=s("../node_modules/lodash-es/get.js"),n=s("./state/selectors/get-raw-site.js"),i=s("./state/site-settings/selectors.js");function a(e,t){var s=Object(n.a)(e,t);if(s)return Object(r.a)(s,"icon.media_id",null);var a=Object(i.a)(e,t);return a?a.site_icon:null}},"./state/selectors/get-site-icon-url.js":function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var r=s("../node_modules/lodash-es/get.js"),n=s("./state/selectors/get-raw-site.js"),i=s("./lib/safe-image-url/index.js"),a=s("./state/selectors/get-media-item.js");var o=s("./state/selectors/get-site-icon-id.js");function c(e,t){var s=function(e,t,s){var r=Object(a.a)(e,t,s);return r?Object(i.a)(r.URL):null}(e,t,Object(o.a)(e,t));return s||Object(r.a)(Object(n.a)(e,t),"icon.img",null)}},"./state/selectors/is-private-site.ts":function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s("./state/selectors/get-raw-site.js"),n=s("./state/site-settings/selectors.js");function i(e,t){var s=Object(r.a)(e,t);if(s)return s.is_private;var i=Object(n.a)(e,t);return i?-1===parseInt(i.blog_public,10):null}},"./state/site-settings/init.js":function(e,t,s){"use strict";var r=s("./state/redux-store.ts"),n=s("../node_modules/@babel/runtime/helpers/defineProperty.js"),i=s.n(n),a=s("../node_modules/@babel/runtime/helpers/objectSpread2.js"),o=s.n(a),c=s("../node_modules/lodash-es/includes.js"),u=s("./state/utils/without-persistence.js"),l=s("./state/utils/schema-utils.js"),d=s("./state/utils/reducer-utils.js"),m=s("./state/utils/with-storage-key.js"),j=s("./state/action-types.js"),b=Object(u.a)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j.Qr:var s=t.siteId;return o()(o()({},e),{},i()({},s,!0));case j.Sr:var r=t.siteId;return o()(o()({},e),{},i()({},r,!1));case j.Rr:var n=t.siteId;return o()(o()({},e),{},i()({},n,!1))}return e})),f=Object(u.a)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j.Tr:var s=t.siteId;return o()(o()({},e),{},i()({},s,{saving:!0,status:"pending",error:!1}));case j.Vr:var r=t.siteId;return o()(o()({},e),{},i()({},r,{saving:!1,status:"success",error:!1}));case j.Ur:var n=t.siteId,a=t.error;return o()(o()({},e),{},i()({},n,{saving:!1,status:"error",error:a}))}return e})),p=Object(l.a)({type:"object",additionalProperties:!1,patternProperties:{"^\\d+$":{type:"object"}}},(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case j.Pr:var s=t.siteId,r=t.settings;return o()(o()({},e),{},i()({},s,r));case j.Wr:var n=t.siteId,a=t.settings;return o()(o()({},e),{},i()({},n,o()(o()({},e[n]),a)));case j.Lj:var u=t.siteId,l=t.mediaIds,d=e[u];return d&&Object(c.a)(l,d.site_icon)?o()(o()({},e),{},i()({},u,o()(o()({},d),{},{site_icon:null}))):e}return e})),g=Object(d.a)({items:p,requesting:b,saveRequests:f}),v=Object(m.a)("siteSettings",g);Object(r.a)(["siteSettings"],v)},"./state/site-settings/selectors.js":function(e,t,s){"use strict";s.d(t,"c",(function(){return n})),s.d(t,"d",(function(){return i})),s.d(t,"a",(function(){return a})),s.d(t,"e",(function(){return o})),s.d(t,"b",(function(){return c}));var r=s("../node_modules/lodash-es/get.js");s("./state/site-settings/init.js");function n(e,t){return Object(r.a)(e.siteSettings.requesting,[t],!1)}function i(e,t){return Object(r.a)(e.siteSettings.saveRequests,[t,"saving"],!1)}function a(e,t){return Object(r.a)(e.siteSettings.items,[t],null)}function o(e,t){return"success"===function(e,t){return Object(r.a)(e.siteSettings.saveRequests,[t,"status"])}(e,t)}function c(e,t){return Object(r.a)(e.siteSettings.saveRequests,[t,"error"],!1)}},"./state/ui/selectors/get-selected-site-slug.js":function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var r=s("./state/sites/selectors/get-site-slug.js"),n=s("./state/ui/selectors/get-selected-site-id.js");function i(e){var t=Object(n.a)(e);return t?Object(r.a)(e,t):null}}}]);