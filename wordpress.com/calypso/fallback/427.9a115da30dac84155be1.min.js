(window.webpackJsonp=window.webpackJsonp||[]).push([[427],{"./components/infinite-list/index.jsx":function(e,t,o){"use strict";o.d(t,"a",(function(){return q}));var s=o("../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),i=o.n(s),n=o("../node_modules/@babel/runtime/helpers/classCallCheck.js"),r=o.n(n),l=o("../node_modules/@babel/runtime/helpers/createClass.js"),h=o.n(l),d=o("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),a=o.n(d),c=o("../node_modules/@babel/runtime/helpers/inherits.js"),p=o.n(c),u=o("../node_modules/@babel/runtime/helpers/createSuper.js"),g=o.n(u),m=o("../node_modules/@babel/runtime/helpers/defineProperty.js"),f=o.n(m),H=o("../node_modules/debug/src/browser.js"),x=o.n(H),R=o("../node_modules/lodash-es/noop.js"),v=o("../node_modules/page/page.js"),I=o.n(v),P=o("../node_modules/prop-types/index.js"),b=o.n(P),w=o("../node_modules/react/index.js"),S=o.n(w),y=o("../node_modules/react-dom/index.js"),T=o.n(y),_=o("./lib/detect-history-navigation/index.js"),L=o("../node_modules/lodash-es/throttle.js"),k=x()("calypso:infinite-list:scroll-store"),B={leading:!1},C=new Map,A=new Map,j={getPositions:function(e){var t=C.get(e);return k("getting positions:",e,t),t},storePositions:Object(L.a)((function(e,t){k("storing positions:",e,t),C.set(e,t)}),1e3,B),getScrollTop:function(e){var t=A.get(e);return k("getting scrollTop:",e,t),t},storeScrollTop:Object(L.a)((function(e,t){k("storing scrollTop:",e,t),A.set(e,t)}),1e3,B)},F=x()("calypso:infinite-list:helper"),M=function(){function e(t,o,s){r()(this,e),this.boundsForRef=t,this.getTopPlaceholderBounds=o,this.getBottomPlaceholderBounds=s,this.itemHeights={},this.contextHeight=null,this.topHideLevelHard=null,this.topHideLevelSoft=null,this.bottomHideLevelHard=null,this.bottomHideLevelSoft=null,this.bottomHideLevelUltraSoft=null,this.props=null,this.scrollPosition=null,this.containerTop=null,this.topPlaceholderHeight=null,this.bottomPlaceholderHeight=null,this.containerBottom=null,this.stateUpdated=null,this.firstRenderedIndex=null,this.lastRenderedIndex=null}return h()(e,[{key:"storedItemHeight",value:function(e){var t=this.props.guessedItemHeight;return e in this.itemHeights&&(t=this.itemHeights[e]),t}},{key:"forEachInRow",value:function(e,t){for(var o=this.props.itemsPerRow,s=e-e%o,i=Math.min(s+o,this.props.items.length)-1,n=s;n<=i;n++)t(this.props.items[n],n)}},{key:"storeRowItemHeights",value:function(e,t){var o=this;this.forEachInRow(t,(function(t){var s,i=o.props.getItemRef(t),n=o.boundsForRef(i);s=n?"bottom"===e?o.containerBottom-o.bottomPlaceholderHeight-n.top:n.bottom-(o.containerTop+o.topPlaceholderHeight):o.props.guessedItemHeight,o.itemHeights[i]=s}))}},{key:"deleteRowItemHeights",value:function(e){var t=this;this.forEachInRow(e,(function(e){var o=t.props.getItemRef(e);delete t.itemHeights[o]}))}},{key:"getRowHeight",value:function(e){var t=this,o=0;return this.forEachInRow(e,(function(e){var s=t.props.getItemRef(e),i=t.storedItemHeight(s);o=Math.max(o,i)})),o}},{key:"updateContextHeight",value:function(e){this.contextHeight!==e&&(this.contextHeight=e,this.topHideLevelHard=Math.min(-1*e,-5*this.props.guessedItemHeight),this.topHideLevelSoft=Math.min(-2*e,-10*this.props.guessedItemHeight),this.bottomHideLevelHard=e+Math.max(e,5*this.props.guessedItemHeight),this.bottomHideLevelSoft=e+Math.max(2*e,10*this.props.guessedItemHeight),this.bottomHideLevelUltraSoft=e+Math.max(3*e,15*this.props.guessedItemHeight))}},{key:"initialLastRenderedIndex",value:function(){return Math.min(this.props.items.length-1,Math.floor(this.bottomHideLevelSoft/this.props.guessedItemHeight)-1)}},{key:"updatePlaceholderDimensions",value:function(){var e=this.getTopPlaceholderBounds(),t=this.getBottomPlaceholderBounds();e&&t&&(this.topPlaceholderHeight=e.height,this.containerTop=e.top,this.bottomPlaceholderHeight=t.height,this.containerBottom=t.bottom)}},{key:"scrollChecks",value:function(e){this.reset(e),this.adjustLastRenderedIndex(),this.shouldHideItemsAbove()?this.hideItemsAbove():this.shouldShowItemsAbove()&&this.showItemsAbove(),this.shouldHideItemsBelow()?this.hideItemsBelow():this.shouldShowItemsBelow()&&this.showItemsBelow(),this.shouldLoadNextPage()&&this.loadNextPage()}},{key:"reset",value:function(e){this.stateUpdated=!1,this.firstRenderedIndex=e.firstRenderedIndex,this.lastRenderedIndex=e.lastRenderedIndex}},{key:"adjustLastRenderedIndex",value:function(){var e=this.initialLastRenderedIndex(),t=this.lastRenderedIndex||0,o=this.firstRenderedIndex||0,s=this.props.items.length,i=t;0===s&&(i=-1),t>=s&&(i=Math.min(o+e,s-1)),-1===i&&s>0&&0===o&&(i=e),i!==this.lastRenderedIndex&&(this.stateUpdated=!0,this.lastRenderedIndex=i)}},{key:"shouldHideItemsAbove",value:function(){return this.containerTop+this.topPlaceholderHeight<this.topHideLevelSoft}},{key:"hideItemsAbove",value:function(){for(var e;this.firstRenderedIndex<this.props.items.length;){if(this.storeRowItemHeights("top",this.firstRenderedIndex),e=this.getRowHeight(this.firstRenderedIndex),this.containerTop+this.topPlaceholderHeight+e>this.topHideLevelHard){this.deleteRowItemHeights(this.firstRenderedIndex);break}this.topPlaceholderHeight+=e,this.firstRenderedIndex+=this.props.itemsPerRow,this.stateUpdated=!0,F("hiding top item",e,this.topPlaceholderHeight)}}},{key:"shouldShowItemsAbove",value:function(){return this.containerTop+this.topPlaceholderHeight>this.topHideLevelHard}},{key:"showItemsAbove",value:function(){for(var e;this.firstRenderedIndex>0&&(e=this.getRowHeight(this.firstRenderedIndex-this.props.itemsPerRow),!(this.containerTop+this.topPlaceholderHeight-e<this.topHideLevelSoft));)this.deleteRowItemHeights(this.firstRenderedIndex-this.props.itemsPerRow),this.firstRenderedIndex-=this.props.itemsPerRow,this.firstRenderedIndex=Math.max(0,this.firstRenderedIndex),this.firstRenderedIndex<=0?this.topPlaceholderHeight=0:this.topPlaceholderHeight=Math.max(0,this.topPlaceholderHeight-e),this.stateUpdated=!0,F("showing top item",e,this.topPlaceholderHeight)}},{key:"shouldHideItemsBelow",value:function(){return this.containerBottom-this.bottomPlaceholderHeight>this.bottomHideLevelUltraSoft}},{key:"hideItemsBelow",value:function(){for(var e;this.lastRenderedIndex>=0;){if(this.storeRowItemHeights("bottom",this.lastRenderedIndex),e=this.getRowHeight(this.lastRenderedIndex),this.containerBottom-this.bottomPlaceholderHeight-e<this.bottomHideLevelHard){this.deleteRowItemHeights(this.lastRenderedIndex);break}this.bottomPlaceholderHeight+=e,this.lastRenderedIndex-=this.props.itemsPerRow,this.stateUpdated=!0,F("hiding bottom item",e,this.bottomPlaceholderHeight)}}},{key:"shouldShowItemsBelow",value:function(){return this.containerBottom-this.bottomPlaceholderHeight<this.bottomHideLevelHard}},{key:"showItemsBelow",value:function(){for(var e,t;this.lastRenderedIndex<this.props.items.length-1&&(e=this.getRowHeight(this.lastRenderedIndex+this.props.itemsPerRow),!((t=this.containerBottom-this.bottomPlaceholderHeight)+e>this.bottomHideLevelSoft&&t>this.bottomHideLevelHard));)this.deleteRowItemHeights(this.lastRenderedIndex+this.props.itemsPerRow),this.bottomPlaceholderHeight-e<0?(this.containerBottom+=e-this.bottomPlaceholderHeight,this.bottomPlaceholderHeight=0):this.bottomPlaceholderHeight-=e,this.lastRenderedIndex+=this.props.itemsPerRow,this.lastRenderedIndex=Math.min(this.lastRenderedIndex,this.props.items.length-1),this.lastRenderedIndex>=this.props.items.length-1&&(this.bottomPlaceholderHeight=0),this.stateUpdated=!0,F("showing bottom item",e,this.bottomPlaceholderHeight)}},{key:"shouldLoadNextPage",value:function(){return!this.props.fetchingNextPage&&!this.props.lastPage&&(0===this.bottomPlaceholderHeight&&this.containerBottom<this.bottomHideLevelHard)}},{key:"loadNextPage",value:function(){var e=this;if(!this.queuedFetchNextPage){var t=this.triggeredByScroll;F("fetching next page",this.containerBottom,this.bottomPlaceholderHeight),this.scrollPosition>this.contextHeight&&(t=!0),this.queuedFetchNextPage=Promise.resolve().then((function(){if(e.queuedFetchNextPage=null,e.props.fetchingNextPage||e.props.lastPage)return!1;e.props.fetchNextPage({triggeredByScroll:t})}))}}}]),e}(),N=o("./lib/scroll-to/index.js"),U=o("./lib/react-smart-set-state/index.js"),E=(o("./components/infinite-list/style.scss"),x()("calypso:infinite-list")),q=function(e){p()(o,e);var t=g()(o);function o(){var e;r()(this,o);for(var s=arguments.length,i=new Array(s),n=0;n<s;n++)i[n]=arguments[n];return e=t.call.apply(t,[this].concat(i)),f()(a()(e),"lastScrollTop",-1),f()(a()(e),"scrollRAFHandle",!1),f()(a()(e),"scrollHelper",null),f()(a()(e),"isScrolling",!1),f()(a()(e),"_isMounted",!1),f()(a()(e),"smartSetState",U.a),f()(a()(e),"topPlaceholderRef",S.a.createRef()),f()(a()(e),"bottomPlaceholderRef",S.a.createRef()),f()(a()(e),"onScroll",(function(){e.isScrolling||e.scrollRAFHandle||e.getCurrentScrollTop()===e.lastScrollTop||(e.scrollRAFHandle=window.requestAnimationFrame(e.scrollChecks))})),f()(a()(e),"scrollChecks",(function(){e._isMounted&&e.getCurrentScrollTop()!==e.lastScrollTop?e.updateScroll({triggeredByScroll:!0}):e.scrollRAFHandle=null})),f()(a()(e),"boundsForRef",(function(t){return t in e.refs?T.a.findDOMNode(e.refs[t]).getBoundingClientRect():null})),f()(a()(e),"getTopPlaceholderBounds",(function(){return e.topPlaceholderRef.current&&e.topPlaceholderRef.current.getBoundingClientRect()})),f()(a()(e),"getBottomPlaceholderBounds",(function(){return e.bottomPlaceholderRef.current&&e.bottomPlaceholderRef.current.getBoundingClientRect()})),f()(a()(e),"_resetScroll",(function(t){var o=e.state.scrollTop;e._contextLoaded()&&(E("history setting scroll position:",t),e._setContainerY(o),e._scrollContainer.removeEventListener("scroll",e._resetScroll),E("override scroll position from HTML5 history popstate:",o))})),e}return h()(o,[{key:"UNSAFE_componentWillMount",value:function(){var e,t,o=I.a.current;_.a.loadedViaHistory()&&(e=j.getPositions(o),t=j.getScrollTop(o)),e&&t&&(E("overriding scrollTop:",t),e.scrollTop=t),this.scrollHelper=new M(this.boundsForRef,this.getTopPlaceholderBounds,this.getBottomPlaceholderBounds),this.scrollHelper.props=this.props,this._contextLoaded()&&(this._scrollContainer=this.props.context||window,this.scrollHelper.updateContextHeight(this.getCurrentContextHeight())),this.isScrolling=!1,e?E("infinite-list positions loaded from store"):(E("infinite-list positions reset for new list"),e={firstRenderedIndex:0,topPlaceholderHeight:0,lastRenderedIndex:this.scrollHelper.initialLastRenderedIndex(),bottomPlaceholderHeight:0,scrollTop:0}),E("infinite list mounting",e),this.setState(e)}},{key:"componentDidMount",value:function(){this._isMounted=!0,this._contextLoaded()&&this._setContainerY(this.state.scrollTop),_.a.loadedViaHistory()&&this._overrideHistoryScroll(),E("setting scrollTop:",this.state.scrollTop),this.updateScroll({triggeredByScroll:!1}),this._contextLoaded()&&this._scrollContainer.addEventListener("scroll",this.onScroll)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.scrollHelper.props=e,this.isScrolling||(this.cancelAnimationFrame(),this.updateScroll({triggeredByScroll:!1})),e.context!==this.props.context&&this._contextLoaded()&&this._scrollContainer.removeEventListener("scroll",this._resetScroll)}},{key:"componentDidUpdate",value:function(e){var t=this;this._contextLoaded()&&(this.props.context!==e.context&&(this._scrollContainer&&this._scrollContainer.removeEventListener("scroll",this.onScroll),this._scrollContainer=this.props.context||window,this._scrollContainer.addEventListener("scroll",this.onScroll),_.a.loadedViaHistory()&&this._overrideHistoryScroll()),this.isScrolling||(this.scrollUpdate=setTimeout((function(){t.cancelAnimationFrame(),t.updateScroll({triggeredByScroll:!1}),t.scrollUpdate=!1}))))}},{key:"reset",value:function(){this.cancelAnimationFrame(),this.scrollHelper=new M(this.boundsForRef,this.getTopPlaceholderBounds,this.getBottomPlaceholderBounds),this.scrollHelper.props=this.props,this._contextLoaded()&&(this._scrollContainer=this.props.context||window,this.scrollHelper.updateContextHeight(this.getCurrentContextHeight())),this.isScrolling=!1,this.setState({firstRenderedIndex:0,topPlaceholderHeight:0,lastRenderedIndex:this.scrollHelper.initialLastRenderedIndex(),bottomPlaceholderHeight:0,scrollTop:0})}},{key:"componentWillUnmount",value:function(){this._scrollContainer.removeEventListener("scroll",this.onScroll),this._scrollContainer.removeEventListener("scroll",this._resetScroll),this.cancelAnimationFrame(),this.cancelScrollUpdate(),this._isMounted=!1}},{key:"cancelAnimationFrame",value:function(){this.scrollRAFHandle&&(window.cancelAnimationFrame(this.scrollRAFHandle),this.scrollRAFHandle=null),this.lastScrollTop=-1}},{key:"cancelScrollUpdate",value:function(){this.scrollUpdate&&(clearTimeout(this.scrollUpdate),this.scrollUpdate=!1)}},{key:"getCurrentContextHeight",value:function(){return(this.props.context||window.document.documentElement).clientHeight}},{key:"getCurrentScrollTop",value:function(){return this.props.context?(E("getting scrollTop from context"),this.props.context.scrollTop):window.pageYOffset}},{key:"scrollToTop",value:function(){var e=this;this.cancelAnimationFrame(),this.isScrolling=!0,this.props.context&&this.props.context!==window?(this.props.context.scrollTop=0,this.updateScroll({triggeredByScroll:!1}),this.isScrolling=!1):Object(N.a)({x:0,y:0,duration:250,onComplete:function(){e._isMounted&&e.updateScroll({triggeredByScroll:!1}),e.isScrolling=!1}})}},{key:"updateScroll",value:function(e){var t,o=I.a.current;this._contextLoaded()&&(this.lastScrollTop=this.getCurrentScrollTop(),j.storeScrollTop(o,this.lastScrollTop),this.scrollHelper.updateContextHeight(this.getCurrentContextHeight()),this.scrollHelper.scrollPosition=this.lastScrollTop,this.scrollHelper.triggeredByScroll=e.triggeredByScroll,this.scrollHelper.updatePlaceholderDimensions(),this.scrollHelper.scrollChecks(this.state),this.scrollHelper.stateUpdated&&(t={firstRenderedIndex:this.scrollHelper.firstRenderedIndex,topPlaceholderHeight:this.scrollHelper.topPlaceholderHeight,lastRenderedIndex:this.scrollHelper.lastRenderedIndex,bottomPlaceholderHeight:this.scrollHelper.bottomPlaceholderHeight,scrollTop:this.lastScrollTop},this.lastScrollTop=-1,E("new scroll positions",t,this.state),this.smartSetState(t),j.storePositions(o,t)),this.scrollRAFHandle=window.requestAnimationFrame(this.scrollChecks))}},{key:"getVisibleItemIndexes",value:function(e){var t,o,s,i,n=T.a.findDOMNode(this),r=[],l=this.state.firstRenderedIndex,h=this.state.lastRenderedIndex,d=e&&e.offsetTop?e.offsetTop:0,a=e&&e.offsetBottom?e.offsetBottom:0;if(a=a||0,h>-1)for(s=n.children,i=1;i<s.length-1;i++)o=n.children[i].getBoundingClientRect(),t=window.innerHeight||document.documentElement.clientHeight,(o.top<0&&Math.abs(o.top)<o.height-d||o.top>0&&o.top<t-a)&&r.push({index:l+i-1,bounds:o});return r}},{key:"render",value:function(){var e,t=this.props,o=t.items,s=t.fetchingNextPage,n=(t.lastPage,t.guessedItemHeight,t.itemsPerRow,t.fetchNextPage,t.getItemRef,t.renderItem),r=t.renderLoadingPlaceholders,l=t.renderTrailingItems,h=(t.context,i()(t,["items","fetchingNextPage","lastPage","guessedItemHeight","itemsPerRow","fetchNextPage","getItemRef","renderItem","renderLoadingPlaceholders","renderTrailingItems","context"])),d=this.state.lastRenderedIndex,a=[];for((-1===d||d>o.length-1)&&(E("resetting lastRenderedIndex, currently at %s, %d items",d,o.length),d=Math.min(this.state.firstRenderedIndex+this.scrollHelper.initialLastRenderedIndex(),o.length-1),E("reset lastRenderedIndex to %s",d)),E("rendering %d to %d",this.state.firstRenderedIndex,d),e=this.state.firstRenderedIndex;e<=d;e++)a.push(n(o[e],e));return s&&(a=a.concat(r())),S.a.createElement("div",h,S.a.createElement("div",{ref:this.topPlaceholderRef,className:"infinite-list__spacer",style:{height:this.state.topPlaceholderHeight}}),a,l(),S.a.createElement("div",{ref:this.bottomPlaceholderRef,className:"infinite-list__spacer",style:{height:this.state.bottomPlaceholderHeight}}))}},{key:"_setContainerY",value:function(e){this.props.context&&this.props.context!==window?this.props.context.scrollTop=e:window.scrollTo(0,e)}},{key:"_overrideHistoryScroll",value:function(){this._contextLoaded()&&this._scrollContainer.addEventListener("scroll",this._resetScroll)}},{key:"_contextLoaded",value:function(){return this.props.context||!1===this.props.context||!("context"in this.props)}}]),o}(S.a.Component);f()(q,"propTypes",{items:b.a.array.isRequired,fetchingNextPage:b.a.bool.isRequired,lastPage:b.a.bool.isRequired,guessedItemHeight:b.a.number.isRequired,itemsPerRow:b.a.number,fetchNextPage:b.a.func.isRequired,getItemRef:b.a.func.isRequired,renderItem:b.a.func.isRequired,renderLoadingPlaceholders:b.a.func.isRequired,renderTrailingItems:b.a.func,context:b.a.oneOfType([b.a.object,b.a.bool])}),f()(q,"defaultProps",{itemsPerRow:1,renderTrailingItems:R.a})},"./components/infinite-list/style.scss":function(e,t,o){},"./lib/react-smart-set-state/index.js":function(e,t,o){"use strict";function s(e){return!!Object.keys(e).some((function(t){return!(this.state&&this.state.hasOwnProperty(t))||this.state[t]!==e[t]}),this)&&(this.setState(e),!0)}o.d(t,"a",(function(){return s}))}}]);