(window.webpackJsonp=window.webpackJsonp||[]).push([[347],{"./blocks/image-editor/index.jsx":function(e,t,o){"use strict";var n=o("../node_modules/@babel/runtime/helpers/objectSpread2.js"),a=o.n(n),s=o("../node_modules/@babel/runtime/helpers/classCallCheck.js"),i=o.n(s),r=o("../node_modules/@babel/runtime/helpers/createClass.js"),l=o.n(r),d=o("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),c=o.n(d),p=o("../node_modules/@babel/runtime/helpers/inherits.js"),u=o.n(p),m=o("../node_modules/@babel/runtime/helpers/createSuper.js"),h=o.n(m),g=o("../node_modules/@babel/runtime/helpers/defineProperty.js"),f=o.n(g),b=o("../node_modules/prop-types/index.js"),v=o.n(b),E=o("../node_modules/react/index.js"),y=o.n(E),w=o("../node_modules/react-redux/es/index.js"),C=o("../node_modules/redux/es/redux.js"),R=o("../node_modules/lodash-es/isEqual.js"),j=o("../node_modules/lodash-es/noop.js"),D=o("../node_modules/lodash-es/partial.js"),x=o("./node_modules/path-browserify/index.js"),_=o.n(x),k=o("../packages/i18n-calypso/dist/esm/index.js"),O=o("../node_modules/classnames/index.js"),S=o.n(O),I=o("./components/close-on-escape/index.jsx"),A=o("./components/notice/index.jsx"),N=o("../node_modules/lodash-es/startsWith.js"),T=o("../node_modules/@babel/runtime/helpers/toConsumableArray.js"),L=o.n(T),P=o("../node_modules/@babel/runtime/helpers/extends.js"),B=o.n(P),z=o("../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),M=o.n(z);function F(e){return!(e.pageX&&e.pageY||!e.touches||!e.touches.length)}var H=function(e){u()(o,e);var t=h()(o);function o(){var e;i()(this,o);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),f()(c()(e),"state",{x:e.props.x,y:e.props.y}),f()(c()(e),"dragging",!1),f()(c()(e),"frameRequestId",null),f()(c()(e),"relativePos",null),f()(c()(e),"mousePos",null),f()(c()(e),"draggingStartedHandler",(function(t){e.dragging=!0;var o=F(t)?t.touches[0]:t;e.relativePos={x:o.pageX-e.state.x,y:o.pageY-e.state.y},e.cancelRaf(),e.frameRequestId=requestAnimationFrame(e.update)})),f()(c()(e),"draggingHandler",(function(t){var o=F(t)?t.touches[0]:t,n=o.pageX-e.relativePos.x,a=o.pageY-e.relativePos.y;e.mousePos={x:n,y:a}})),f()(c()(e),"draggingEndedHandler",(function(){e.dragging=!1,e.mousePos=null,e.relativePos=null,e.cancelRaf(),e.removeListeners(),e.props.onStop()})),f()(c()(e),"onTouchStartHandler",(function(t){t.preventDefault(),e.draggingStartedHandler(t),document.addEventListener("touchmove",e.draggingHandler),document.addEventListener("touchend",e.draggingEndedHandler)})),f()(c()(e),"onMouseDownHandler",(function(t){t.preventDefault(),e.draggingStartedHandler(t),document.addEventListener("mousemove",e.draggingHandler),document.addEventListener("mouseup",e.draggingEndedHandler)})),f()(c()(e),"update",(function(){if(e.mousePos){var t=e.props.bounds,o=e.mousePos,n=o.x,a=o.y;t&&(n=Math.max(t.left,Math.min(t.right-e.props.width,n)),a=Math.max(t.top,Math.min(t.bottom-e.props.height,a))),e.dragging&&(e.frameRequestId=requestAnimationFrame(e.update)),e.props.onDrag(n,a),e.props.controlled||e.setState({x:n,y:a})}else e.frameRequestId=requestAnimationFrame(e.update)})),e}return l()(o,[{key:"componentWillUnmount",value:function(){this.cancelRaf(),this.removeListeners()}},{key:"cancelRaf",value:function(){this.frameRequestId&&(cancelAnimationFrame(this.frameRequestId),this.frameRequestId=null)}},{key:"removeListeners",value:function(){document.removeEventListener("mousemove",this.draggingHandler),document.removeEventListener("mouseup",this.draggingEndedHandler),document.removeEventListener("touchmove",this.draggingHandler),document.removeEventListener("touchend",this.draggingEndedHandler)}},{key:"render",value:function(){var e=this.props,t=(e.onDrag,e.onStop,e.width,e.height,e.x,e.y,e.controlled,e.bounds,M()(e,["onDrag","onStop","width","height","x","y","controlled","bounds"])),o={transform:"translate("+this.state.x+"px, "+this.state.y+"px)"};return(this.props.width||this.props.height)&&(o.width=this.props.width+"px",o.height=this.props.height+"px"),y.a.createElement("div",B()({},t,{style:o,onMouseDown:this.onMouseDownHandler,onTouchStart:this.onTouchStartHandler}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return t.x!==e.x||t.y!==e.y?{x:e.x,y:e.y}:null}}]),o}(E.Component);f()(H,"defaultProps",{onDrag:function(){},onStop:function(){},width:0,height:0,x:0,y:0,controlled:!1,bounds:null});var U=o("./state/editor/image-editor/selectors.js"),W=o("./state/editor/image-editor/constants.js"),q=o("./state/editor/image-editor/actions.js"),Z=o("./state/editor/image-editor/reducer.js"),V=o("../node_modules/lodash-es/get.js");o("./state/editor/init.js");function X(e){return Object(V.a)(e,"editor.imageEditor.originalAspectRatio",null)}var Y=function(e){u()(o,e);var t=h()(o);function o(e){var n;return i()(this,o),(n=t.call(this,e)).state=n.getDefaultState(e),n.onTopLeftDrag=n.onTopLeftDrag.bind(c()(n)),n.onTopRightDrag=n.onTopRightDrag.bind(c()(n)),n.onBottomLeftDrag=n.onBottomLeftDrag.bind(c()(n)),n.onBottomRightDrag=n.onBottomRightDrag.bind(c()(n)),n.applyCrop=n.applyCrop.bind(c()(n)),n.onBorderDrag=n.onBorderDrag.bind(c()(n)),n}return l()(o,[{key:"getDefaultState",value:function(e){return{top:e.bounds.topBound,left:e.bounds.leftBound,bottom:e.bounds.bottomBound,right:e.bounds.rightBound}}},{key:"UNSAFE_componentWillMount",value:function(){this.updateCrop(this.getDefaultState(this.props),this.props,this.applyComputedCrop)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,o=t.bounds,n=t.aspectRatio,a=t.crop;if(!Object(R.a)(o,e.bounds)){var s=e.bounds.rightBound-e.bounds.leftBound,i=e.bounds.bottomBound-e.bounds.topBound,r=e.bounds.topBound+e.crop.topRatio*i,l=e.bounds.leftBound+e.crop.leftRatio*s,d={top:r,left:l,bottom:r+e.crop.heightRatio*i,right:l+e.crop.widthRatio*s};this.setState(d),this.updateCrop(d)}n!==e.aspectRatio&&this.updateCrop(this.getDefaultState(e),e,this.applyCrop),e.imageEditorHasChanges||!Object(R.a)(e.crop,Z.b)||Object(R.a)(a,e.crop)||this.updateCrop(this.getDefaultState(e),e,this.applyComputedCrop)}},{key:"updateCrop",value:function(e,t,o){var n=(t=t||this.props).aspectRatio;if(n!==W.a.FREE){var a,s,i,r,l=t.degrees%180!=0,d=Object.assign({},this.state,e),c=d.right-d.left,p=d.bottom-d.top;switch(n){case W.a.ORIGINAL:if(!this.props.originalAspectRatio)return void this.setState(e,o);var u=this.props.originalAspectRatio,m=u.width,h=u.height;a=l?h:m,s=l?m:h;break;case W.a.ASPECT_1X1:a=1,s=1;break;case W.a.ASPECT_16X9:a=l?9:16,s=l?16:9;break;case W.a.ASPECT_4X3:a=l?3:4,s=l?4:3;break;case W.a.ASPECT_3X2:a=l?2:3,s=l?3:2}var g=Math.min(c/a,p/s);i=a*g,r=s*g,e.hasOwnProperty("top")?e.top=d.bottom-r:e.hasOwnProperty("bottom")&&(e.bottom=d.top+r),e.hasOwnProperty("left")?e.left=d.right-i:e.hasOwnProperty("right")&&(e.right=d.left+i),this.setState(e,o)}else this.setState(e,o)}},{key:"onTopLeftDrag",value:function(e,t){var o=this.state,n=o.right,a=o.bottom,s=this.props.minCropSize,i=t,r=e;n-r<=s.width&&(r=n-s.width),a-i<=s.height&&(i=a-s.height),this.updateCrop({top:i,left:r})}},{key:"onTopRightDrag",value:function(e,t){var o=this.state,n=o.left,a=o.bottom,s=this.props.minCropSize,i=t,r=e;r-n<=s.width&&(r=n+s.width),a-i<=s.height&&(i=a-s.height),this.updateCrop({top:i,right:r})}},{key:"onBottomRightDrag",value:function(e,t){var o=this.state,n=o.left,a=o.top,s=this.props.minCropSize,i=t,r=e;r-n<=s.width&&(r=n+s.width),i-a<=s.height&&(i=a+s.height),this.updateCrop({bottom:i,right:r})}},{key:"onBottomLeftDrag",value:function(e,t){var o=this.state,n=o.right,a=o.top,s=this.props.minCropSize,i=t,r=e;n-r<=s.width&&(r=n-s.width),i-a<=s.height&&(i=a+s.height),this.updateCrop({bottom:i,left:r})}},{key:"onBorderDrag",value:function(e,t){var o=this.state,n=o.top,a=o.left,s=o.right-a,i=o.bottom-n;this.setState({top:t,left:e,bottom:t+i,right:e+s})}},{key:"getCropBounds",value:function(){var e=this.state,t=e.top,o=e.left,n=e.right,a=e.bottom,s=this.props.bounds,i=s.topBound,r=s.leftBound,l=t-i,d=o-r,c=n-o,p=a-t,u=s.rightBound-r,m=s.bottomBound-i,h=this.props.degrees%180!=0;if(this.props.originalAspectRatio){var g=this.props.originalAspectRatio,f=g.width,b=g.height;m=u*((h?f:b)/(h?b:f))}return[l/m,d/u,c/u,p/m]}},{key:"applyCrop",value:function(){var e;(e=this.props).imageEditorCrop.apply(e,L()(this.getCropBounds()))}},{key:"applyComputedCrop",value:function(){var e;(e=this.props).imageEditorComputedCrop.apply(e,L()(this.getCropBounds()))}},{key:"render",value:function(){var e=this.state,t=e.top,o=e.left,n=e.right,a=e.bottom,s=n-o,i=a-t,r="image-editor__crop-handle",l=this.props.bounds,d=l.topBound,c=l.leftBound,p=l.rightBound,u=l.bottomBound;return y.a.createElement("div",null,y.a.createElement("div",{className:"image-editor__crop-background",style:{top:d+"px",left:o+"px",width:s+"px",height:Math.max(0,t-d)+"px"}}),y.a.createElement("div",{className:"image-editor__crop-background",style:{top:d+"px",left:c+"px",width:Math.max(0,o-c)+"px",height:Math.max(0,u-d)+"px"}}),y.a.createElement("div",{className:"image-editor__crop-background",style:{top:a+"px",left:o+"px",width:s+"px",height:Math.max(0,u-a)+"px"}}),y.a.createElement("div",{className:"image-editor__crop-background",style:{top:d+"px",left:n+"px",width:Math.max(0,p-n)+"px",height:Math.max(0,u-d)+"px"}}),y.a.createElement(H,{ref:"border",onDrag:this.onBorderDrag,onStop:this.applyCrop,x:o,y:t,width:s,height:i,bounds:{top:d,left:c,bottom:u,right:p},className:"image-editor__crop"}),y.a.createElement(H,{onDrag:this.onTopLeftDrag,onStop:this.applyCrop,x:o,y:t,controlled:!0,bounds:{bottom:a,right:n,top:d,left:c},ref:"topLeft",className:S()(r,r+"-nwse")}),y.a.createElement(H,{onDrag:this.onTopRightDrag,onStop:this.applyCrop,y:t,x:n,controlled:!0,bounds:{bottom:a,left:o,top:d,right:p},ref:"topRight",className:S()(r,r+"-nesw")}),y.a.createElement(H,{onDrag:this.onBottomRightDrag,onStop:this.applyCrop,y:a,x:n,controlled:!0,bounds:{top:t,left:o,bottom:u,right:p},ref:"bottomRight",className:S()(r,r+"-nwse")}),y.a.createElement(H,{onDrag:this.onBottomLeftDrag,onStop:this.applyCrop,y:a,x:o,controlled:!0,bounds:{top:t,right:n,bottom:u,left:c},ref:"bottomLeft",className:S()(r,r+"-nesw")}))}}]),o}(E.Component);f()(Y,"propTypes",{degrees:v.a.number,bounds:v.a.shape({topBound:v.a.number,leftBound:v.a.number,bottomBound:v.a.number,rightBound:v.a.number}),crop:v.a.shape({topRatio:v.a.number,leftRatio:v.a.number,widthRatio:v.a.number,heightRatio:v.a.number}),aspectRatio:v.a.string,imageEditorCrop:v.a.func,imageEditorComputedCrop:v.a.func,minCropSize:v.a.shape({width:v.a.number,height:v.a.number}),imageEditorHasChanges:v.a.bool}),f()(Y,"defaultProps",{degrees:0,bounds:{topBound:0,leftBound:0,bottomBound:100,rightBound:100},imageEditorCrop:j.a,imageEditorComputedCrop:j.a,minCropSize:{width:50,height:50},imageEditorHasChanges:!1});var G=Object(w.c)((function(e){return{bounds:Object(U.c)(e),crop:Object(U.b)(e),aspectRatio:Object(U.a)(e),degrees:Object(U.e)(e).degrees,originalAspectRatio:X(e),imageEditorHasChanges:Object(U.f)(e)}}),{imageEditorCrop:q.b,imageEditorComputedCrop:q.a})(Y);var K=o("../node_modules/lodash-es/isInteger.js");function J(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.c.WIDTH,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.c.HEIGHT,n=X(e);if(n){var a=n.width,s=n.height;if(Object(K.a)(a)&&Object(K.a)(s)&&a>t&&s>o)return!0}return!1}var Q=function(e){u()(o,e);var t=h()(o);function o(){var e;i()(this,o);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),f()(c()(e),"frameRateInterval",1e3/30),f()(c()(e),"requestAnimationFrameId",null),f()(c()(e),"lastTimestamp",null),f()(c()(e),"isMounted",!1),f()(c()(e),"canvasRef",y.a.createRef()),f()(c()(e),"onWindowResize",(function(){e.requestAnimationFrameId=window.requestAnimationFrame(e.updateCanvasPosition)})),f()(c()(e),"onLoadComplete",(function(t){"load"===t.type&&e.isMounted&&(e.drawImage(),e.updateCanvasPosition(),"undefined"!=typeof window&&(e.lastTimestamp=window.performance.now(),window.addEventListener("resize",e.onWindowResize)),e.props.setImageEditorImageHasLoaded(e.image.width,e.image.height))})),f()(c()(e),"updateCanvasPosition",(function(t){var o=t,n=o-e.lastTimestamp;if(!(n<e.frameRateInterval)){e.lastTimestamp=o-n%e.frameRateInterval;var a=e.props.crop,s=a.leftRatio,i=a.topRatio,r=a.widthRatio,l=a.heightRatio,d=e.canvasRef.current,c=-50*r-100*s,p=-50*l-100*i,u=d.offsetTop,m=d.offsetLeft,h=d.offsetWidth,g=d.offsetHeight;e.props.setImageEditorCropBounds(u-g*-p/100,m-h*-c/100,u+g*(1+p/100),m+h*(1+c/100))}})),e}return l()(o,[{key:"componentDidMount",value:function(){this.isMounted=!0}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.src!==e.src&&this.getImage(e.src)}},{key:"isBlobSrc",value:function(e){return Object(N.a)(e,"blob")}},{key:"getImage",value:function(e){var t=this,o=this.props,n=o.onLoadError,a=o.mimeType,s=new XMLHttpRequest;this.isBlobSrc(e)||(e+="?"),s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(){if(t.isMounted){var e=window.URL.createObjectURL(new Blob([s.response],{type:a}));t.initImage(e)}},s.onerror=function(e){return n(e)},s.send()}},{key:"initImage",value:function(e){this.image=new Image,this.image.src=e,this.image.onload=this.onLoadComplete,this.image.onerror=this.onLoadComplete}},{key:"componentWillUnmount",value:function(){"undefined"!=typeof window&&this.onWindowResize&&(window.removeEventListener("resize",this.onWindowResize),window.cancelAnimationFrame(this.requestAnimationFrameId)),this.isMounted=!1}},{key:"componentDidUpdate",value:function(e){this.props.src!==e.src&&this.getImage(this.props.src),this.drawImage(),this.updateCanvasPosition()}},{key:"toBlob",value:function(e){var t=this.props.crop,o=t.leftRatio,n=t.topRatio,a=t.widthRatio,s=t.heightRatio,i=this.props,r=i.mimeType,l=i.transform,d=this.canvasRef.current.getContext("2d"),c=l.degrees%180!=0,p=c?this.image.height:this.image.width,u=c?this.image.width:this.image.height,m=o*p,h=n*u,g=a*p,f=s*u,b=d.getImageData(m,h,g,f),v=document.createElement("canvas");v.width=g,v.height=f,v.getContext("2d").putImageData(b,0,0),function(e,t,o,n){var a=window,s=a.HTMLCanvasElement,i=a.Blob,r=a.atob;s.prototype.toBlob||Object.defineProperty(s.prototype,"toBlob",{value:function(e,t,o){for(var n=r(this.toDataURL(t,o).split(",")[1]),a=n.length,s=new Uint8Array(a),l=0;l<a;l++)s[l]=n.charCodeAt(l);e(new i([s],{type:t||"image/png"}))}}),e.toBlob(t,o,n)}(v,e,r,1)}},{key:"drawImage",value:function(){if(this.image){var e=this.canvasRef.current,t=this.image.width,o=this.image.height,n=this.props.transform,a=n.degrees%180!=0;e.width=a?o:t,e.height=a?t:o;var s=e.getContext("2d");s.clearRect(0,0,e.width,e.height),s.save(),s.setTransform(1,0,0,1,e.width/2,e.height/2),s.scale(n.scaleX,n.scaleY),s.rotate(n.degrees*Math.PI/180),s.drawImage(this.image,-t/2,-o/2),s.restore()}}},{key:"preventDrag",value:function(e){return e.preventDefault(),!1}},{key:"render",value:function(){var e=this.props.crop,t=e.leftRatio,o=e.topRatio,n=e.widthRatio,a=e.heightRatio,s=this.props,i=s.isImageLoaded,r=s.showCrop,l={transform:"translate("+(-50*n-100*t)+"%, "+(-50*a-100*o)+"%)",maxWidth:85/n+"%",maxHeight:85/a+"%"},d=S()("image-editor__canvas",{"is-placeholder":!i});return y.a.createElement("div",{className:"image-editor__canvas-container"},y.a.createElement("canvas",{ref:this.canvasRef,style:l,onMouseDown:this.preventDrag,className:d}),r&&y.a.createElement(G,null))}}]),o}(E.Component);f()(Q,"propTypes",{src:v.a.string,mimeType:v.a.string,transform:v.a.shape({degrees:v.a.number,scaleX:v.a.number,scaleY:v.a.number}),crop:v.a.shape({topRatio:v.a.number,leftRatio:v.a.number,widthRatio:v.a.number,heightRatio:v.a.number}),setImageEditorCropBounds:v.a.func,setImageEditorImageHasLoaded:v.a.func,onLoadError:v.a.func,isImageLoaded:v.a.bool,showCrop:v.a.bool}),f()(Q,"defaultProps",{transform:{degrees:0,scaleX:1,scaleY:1},crop:{cropTopRatio:0,cropLeftRatio:0,cropWidthRatio:1,cropHeightRatio:1},setImageEditorCropBounds:j.a,setImageEditorImageHasLoaded:j.a,onLoadError:j.a,isImageLoaded:!1,showCrop:!0});var $=Object(w.c)((function(e){var t=Object(U.e)(e),o=Object(U.d)(e),n=o.src,a=o.mimeType,s=Object(U.b)(e),i=Object(U.g)(e),r=J(e);return{src:n,mimeType:a,transform:t,crop:s,isImageLoaded:i,showCrop:!(!i||!r)}}),{setImageEditorCropBounds:q.h,setImageEditorImageHasLoaded:q.k},null,{forwardRef:!0})(Q),ee=o("../node_modules/lodash-es/values.js"),te=o("./components/gridicon/index.tsx"),oe=o("./components/popover/menu.jsx"),ne=o("./components/popover/menu-item.jsx"),ae=function(e){u()(o,e);var t=h()(o);function o(e){var n;return i()(this,o),(n=t.call(this,e)).state={showAspectPopover:!1},n.setAspectMenuContext=n.setAspectMenuContext.bind(c()(n)),n.onAspectOpen=n.onAspectOpen.bind(c()(n)),n.onAspectClose=n.onAspectClose.bind(c()(n)),n.rotate=n.rotate.bind(c()(n)),n.flip=n.flip.bind(c()(n)),n}return l()(o,[{key:"rotate",value:function(){this.props.imageEditorRotateCounterclockwise()}},{key:"flip",value:function(){this.props.imageEditorFlip()}},{key:"onAspectOpen",value:function(e){e.preventDefault();var t=this.props,o=t.isAspectRatioDisabled,n=t.onShowNotice,a=t.translate;o?n(a("To change the aspect ratio, the height and width must be bigger than {{strong}}%(width)dpx{{/strong}}.",{args:{width:W.c.WIDTH,height:W.c.HEIGHT},components:{strong:y.a.createElement("strong",null)}})):this.setState({showAspectPopover:!0})}},{key:"onAspectClose",value:function(e){this.setState({showAspectPopover:!1}),"string"==typeof e&&this.props.setImageEditorAspectRatio(e)}},{key:"setAspectMenuContext",value:function(e){this.setState({popoverContext:e})}},{key:"renderAspectMenu",value:function(){var e=this.state,t=e.popoverContext,o=e.showAspectPopover,n=this.props,a=n.translate,s=n.aspectRatio,i=n.allowedAspectRatios;if(t&&1!==i.length){var r=[{action:W.a.FREE,label:a("Freeform",{context:"Option in image editor used to crop images using freeform aspect ratio"})},{action:W.a.ORIGINAL,label:a("Original")},{action:W.a.ASPECT_1X1,label:a("Square")},{action:W.a.ASPECT_16X9,label:a("16:9")},{action:W.a.ASPECT_4X3,label:a("4:3")},{action:W.a.ASPECT_3X2,label:a("3:2")}];return y.a.createElement(oe.a,{isVisible:o,onClose:this.onAspectClose,position:"top",context:t,className:"image-editor__toolbar-popover popover is-dialog-visible"},r.map((function(e){return-1!==i.indexOf(e.action)?y.a.createElement(ne.a,{key:"image-editor-toolbar-aspect-"+e.action,action:e.action},s===e.action&&y.a.createElement(te.a,{icon:"checkmark",size:12}),e.label):null})))}}},{key:"renderButtons",value:function(){var e=this.props,t=e.translate,o=e.allowedAspectRatios,n=e.isAspectRatioDisabled;return[{tool:"rotate",icon:"rotate",text:t("Rotate"),onClick:this.rotate},1===o.length?null:{tool:"aspect",ref:this.setAspectMenuContext,icon:"crop",text:t("Crop"),onClick:this.onAspectOpen,disabled:n},{tool:"flip-vertical",icon:"flip-vertical",text:t("Flip"),onClick:this.flip}].map((function(e){var t=S()("image-editor__toolbar-button",{"is-disabled":e&&e.disabled});return e?y.a.createElement("button",{key:"image-editor-toolbar-"+e.tool,ref:e.ref,className:t,onClick:e.onClick},y.a.createElement(te.a,{icon:e.icon}),y.a.createElement("span",null,e.text)):null}))}},{key:"render",value:function(){return y.a.createElement("div",{className:"image-editor__toolbar"},this.renderButtons(),this.renderAspectMenu())}}]),o}(E.Component);f()(ae,"propTypes",{aspectRatio:v.a.string,imageEditorRotateCounterclockwise:v.a.func,imageEditorFlip:v.a.func,setImageEditorAspectRatio:v.a.func,allowedAspectRatios:v.a.array,onShowNotice:v.a.func,isAspectRatioDisabled:v.a.bool}),f()(ae,"defaultProps",{imageEditorRotateCounterclockwise:j.a,imageEditorFlip:j.a,setImageEditorAspectRatio:j.a,allowedAspectRatios:Object(ee.a)(W.a),onShowNotice:j.a,isAspectRatioDisabled:!1});var se=Object(w.c)((function(e){return{aspectRatio:Object(U.a)(e),isAspectRatioDisabled:!J(e)}}),{imageEditorRotateCounterclockwise:q.d,imageEditorFlip:q.c,setImageEditorAspectRatio:q.g})(Object(k.c)(ae)),ie=o("../packages/components/dist/esm/button/index.js"),re=function(e){u()(o,e);var t=h()(o);function o(){return i()(this,o),t.apply(this,arguments)}return l()(o,[{key:"render",value:function(){var e=this.props,t=e.hasChanges,o=e.onCancel,n=e.src,a=e.onDone,s=e.onReset,i=e.translate,r=e.doneButtonText;return y.a.createElement("div",{className:"image-editor__buttons"},o&&y.a.createElement(ie.a,{className:"image-editor__buttons-button",onClick:o,"data-e2e-button":"cancel"},i("Cancel")),y.a.createElement(ie.a,{className:"image-editor__buttons-button",disabled:!t,onClick:s,"data-e2e-button":"reset"},i("Reset")),y.a.createElement(ie.a,{className:"image-editor__buttons-button",disabled:!n,primary:!0,onClick:a,"data-e2e-button":"done","data-tip-target":"image-editor-button-done"},r||i(" Done ")))}}]),o}(E.Component);f()(re,"propTypes",{src:v.a.string,hasChanges:v.a.bool,resetImageEditorState:v.a.func,onDone:v.a.func,onCancel:v.a.func,onReset:v.a.func,doneButtonText:v.a.string}),f()(re,"defaultProps",{src:"",hasChanges:!1,resetImageEditorState:j.a,onDone:j.a,onCancel:j.a,onReset:j.a,doneButtonText:""});var le=Object(w.c)((function(e){return{src:Object(U.d)(e).src,hasChanges:Object(U.f)(e)}}))(Object(k.c)(re)),de=o("./lib/media/utils/url.js"),ce=o("./lib/media/utils/get-mime-type.js"),pe=o("./state/ui/selectors/get-selected-site-id.js"),ue=o("./state/sites/selectors/get-site.js"),me=o("./components/data/query-sites/index.jsx"),he=o("../node_modules/lodash-es/includes.js");function ge(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W.b;return Object(he.a)(t,e)||(e=Object(V.a)(t,"0",W.a.FREE)),Object(he.a)(W.b,e)?e:ge(e)}o("./blocks/image-editor/style.scss");var fe=function(e){u()(o,e);var t=h()(o);function o(){var e;i()(this,o);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return e=t.call.apply(t,[this].concat(s)),f()(c()(e),"state",{noticeText:null,noticeStatus:"is-info"}),f()(c()(e),"editCanvasRef",y.a.createRef()),f()(c()(e),"setDefaultAspectRatio",(function(){var t=e.props,o=t.defaultAspectRatio,n=t.allowedAspectRatios;e.props.setImageEditorDefaultAspectRatio(ge(o,n))})),f()(c()(e),"updateFileInfo",(function(t){var o,n=e.props.site,a="default",s="image/png",i="default";t&&(o=t.src||Object(de.a)(t,{photon:n&&!n.is_private}),a=t.file||_.a.basename(o),s=Object(ce.a)(t)||s,i=t.title||i),e.props.resetImageEditorState(),e.props.setImageEditorFileInfo(o,a,s,i)})),f()(c()(e),"convertBlobToImage",(function(t){var o=e.props.onDone,n=document.createElement("img"),s=URL.createObjectURL(t),i=e.getImageEditorProps();n.onload=function(){URL.revokeObjectURL(s),o(null,t,a()(a()({},i),{},{width:n.width,height:n.height}))},n.onerror=function(){o(null,t,i)},n.src=s})),f()(c()(e),"onDone",(function(){var t=e.props,o=t.isImageLoaded,n=t.onDone;o?e.editCanvasRef.current.toBlob(e.convertBlobToImage):n(new Error("Image not loaded yet."),null,e.getImageEditorProps())})),f()(c()(e),"onCancel",(function(){e.props.onCancel(e.getImageEditorProps())})),f()(c()(e),"onReset",(function(){e.props.resetImageEditorState(),e.props.onReset(e.getImageEditorProps())})),f()(c()(e),"getImageEditorProps",(function(){var t=e.props,o=t.src,n=t.fileName,a=t.media,s={src:o,fileName:n,mimeType:t.mimeType,title:t.title,site:t.site,resetAllImageEditorState:e.props.resetAllImageEditorState};return a&&a.ID&&(s.ID=a.ID),s})),f()(c()(e),"showNotice",(function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"is-info";e.setState({noticeText:t,noticeStatus:o})})),f()(c()(e),"clearNoticeState",(function(){e.setState({noticeText:null,noticeStatus:"is-info"})})),f()(c()(e),"renderNotice",(function(){if(!e.state.noticeText)return null;var t="is-info"===e.state.noticeStatus;return y.a.createElement(A.a,{status:e.state.noticeStatus,showDismiss:t,text:e.state.noticeText,isCompact:!1,onDismissClick:e.clearNoticeState,className:"image-editor__notice"})})),f()(c()(e),"onLoadCanvasError",(function(){var t=e.props.translate;e.showNotice(t("Sorry, there was a problem loading the image. Please close this editor and try selecting the image again."),"is-error")})),e}return l()(o,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props.media;e.media&&!Object(R.a)(e.media,t)&&(this.props.resetAllImageEditorState(),this.updateFileInfo(e.media),this.setDefaultAspectRatio())}},{key:"componentDidMount",value:function(){this.updateFileInfo(this.props.media),this.setDefaultAspectRatio()}},{key:"render",value:function(){var e=this.props,t=e.className,o=e.siteId,n=e.allowedAspectRatios,a=this.state.noticeText,s=S()("image-editor",t);return y.a.createElement("div",{className:s},y.a.createElement(I.a,{onEscape:this.onCancel}),y.a.createElement(me.a,{siteId:o}),y.a.createElement("figure",null,y.a.createElement("div",{className:"image-editor__content"},y.a.createElement($,{ref:this.editCanvasRef,onLoadError:this.onLoadCanvasError}),y.a.createElement(se,{onShowNotice:this.showNotice,allowedAspectRatios:n}),y.a.createElement(le,{onCancel:this.props.onCancel&&this.onCancel,onDone:this.onDone,onReset:this.onReset,doneButtonText:this.props.doneButtonText}))),a&&this.renderNotice())}}]),o}(y.a.Component);f()(fe,"propTypes",{media:v.a.object,siteId:v.a.number,onDone:v.a.func,onCancel:v.a.func,onReset:v.a.func,className:v.a.string,defaultAspectRatio:v.a.oneOf(W.b),allowedAspectRatios:v.a.arrayOf(v.a.oneOf(W.b)),site:v.a.object,fileName:v.a.string,setImageEditorFileInfo:v.a.func,setImageEditorDefaultAspectRatio:v.a.func,translate:v.a.func,isImageLoaded:v.a.bool}),f()(fe,"defaultProps",{media:null,onDone:j.a,onCancel:null,onReset:j.a,isImageLoaded:!1,defaultAspectRatio:W.a.FREE,allowedAspectRatios:W.b,setImageEditorDefaultAspectRatio:j.a});t.a=Object(w.c)((function(e,t){var o=t.siteId;return o||(o=Object(pe.a)(e)),a()(a()({},Object(U.d)(e)),{},{site:Object(ue.a)(e,o),isImageLoaded:Object(U.g)(e)})}),(function(e,t){var o={aspectRatio:ge(t.defaultAspectRatio,t.allowedAspectRatios)};return Object(C.bindActionCreators)({setImageEditorFileInfo:q.j,setImageEditorDefaultAspectRatio:q.i,resetImageEditorState:Object(D.a)(q.f,o),resetAllImageEditorState:Object(D.a)(q.e,o)},e)}))(Object(k.c)(fe))},"./blocks/image-editor/style.scss":function(e,t,o){},"./components/drop-zone/index.jsx":function(e,t,o){"use strict";var n=o("../node_modules/@babel/runtime/helpers/classCallCheck.js"),a=o.n(n),s=o("../node_modules/@babel/runtime/helpers/createClass.js"),i=o.n(s),r=o("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),l=o.n(r),d=o("../node_modules/@babel/runtime/helpers/inherits.js"),c=o.n(d),p=o("../node_modules/@babel/runtime/helpers/createSuper.js"),u=o.n(p),m=o("../node_modules/@babel/runtime/helpers/defineProperty.js"),h=o.n(m),g=o("../node_modules/react-dom/index.js"),f=o.n(g),b=o("../node_modules/react/index.js"),v=o.n(b),E=o("../node_modules/prop-types/index.js"),y=o.n(E),w=o("../node_modules/react-redux/es/index.js"),C=o("../node_modules/classnames/index.js"),R=o.n(C),j=o("../packages/i18n-calypso/dist/esm/index.js"),D=o("../node_modules/lodash-es/without.js"),x=o("../node_modules/lodash-es/includes.js"),_=o("../node_modules/lodash-es/noop.js"),k=o("../node_modules/lodash-es/identity.js"),O=o("../packages/components/dist/esm/root-child/index.js"),S=o("./components/gridicon/index.tsx"),I=o("./state/action-types.js");o("./state/drop-zone/init.js");var A=o("./components/translatable/proptype.js"),N=(o("./components/drop-zone/style.scss"),function(e){c()(o,e);var t=u()(o);function o(){var e;a()(this,o);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return e=t.call.apply(t,[this].concat(s)),h()(l()(e),"state",{isDraggingOverDocument:!1,isDraggingOverElement:!1,lastVisibleState:!1}),h()(l()(e),"zoneRef",v.a.createRef()),h()(l()(e),"resetDragState",(function(){(e.state.isDraggingOverDocument||e.state.isDraggingOverElement)&&(e.setState({isDraggingOverDocument:!1,isDraggingOverElement:!1}),e.toggleDropZoneReduxState(!1))})),h()(l()(e),"toggleMutationObserver",(function(){e.disconnectMutationObserver(),e.state.isDraggingOverDocument&&(e.observer=new window.MutationObserver(e.detectNodeRemoval),e.observer.observe(document.body,{childList:!0,subtree:!0}))})),h()(l()(e),"disconnectMutationObserver",(function(){e.observer&&(e.observer.disconnect(),delete e.observer)})),h()(l()(e),"detectNodeRemoval",(function(t){t.forEach((function(t){t.removedNodes.length&&(e.dragEnterNodes=Object(D.a)(e.dragEnterNodes,Array.from(t.removedNodes)))}))})),h()(l()(e),"toggleDraggingOverDocument",(function(t){"dragenter"!==t.type||Object(x.a)(e.dragEnterNodes,t.target)?"dragleave"===t.type&&(e.dragEnterNodes=Object(D.a)(e.dragEnterNodes,t.target)):e.dragEnterNodes.push(t.target);var o=window.CustomEvent&&t instanceof window.CustomEvent?t.detail:t,n=e.props.onVerifyValidTransfer(o.dataTransfer)&&e.dragEnterNodes.length;e.setState({isDraggingOverDocument:n,isDraggingOverElement:n&&(e.props.fullScreen||e.isWithinZoneBounds(o.clientX,o.clientY))}),window.CustomEvent&&t instanceof window.CustomEvent&&(e.dragEnterNodes=Object(D.a)(e.dragEnterNodes,window)),e.toggleDropZoneReduxState(!(!e.state.isDraggingOverDocument&&!e.state.isDraggingOverElement))})),h()(l()(e),"toggleDropZoneReduxState",(function(t){e.state.lastVisibleState!==t&&(t?e.props.showDropZone(e.props.dropZoneName):e.props.hideDropZone(e.props.dropZoneName),e.setState({lastVisibleState:t}))})),h()(l()(e),"preventDefault",(function(e){e.preventDefault()})),h()(l()(e),"isWithinZoneBounds",(function(t,o){if(!e.zoneRef.current)return!1;var n=e.zoneRef.current.getBoundingClientRect();return n.bottom!==n.top&&n.left!==n.right&&(t>=n.left&&t<=n.right&&o>=n.top&&o<=n.bottom)})),h()(l()(e),"onDrop",(function(t){t.dataTransfer&&t.dataTransfer.files.length,e.resetDragState(),t.preventDefault(),(e.props.fullScreen||f.a.findDOMNode(e.zoneRef.current).contains(t.target))&&(e.props.onDrop(t),e.props.onVerifyValidTransfer(t.dataTransfer)&&(t.dataTransfer&&e.props.onFilesDrop(Array.prototype.slice.call(t.dataTransfer.files)),t.stopPropagation()))})),h()(l()(e),"renderContent",(function(){var t=e.props.textLabel?e.props.textLabel:e.props.translate("Drop files to upload");return v.a.createElement("div",{className:"drop-zone__content"},e.props.children?e.props.children:v.a.createElement("div",null,v.a.createElement("span",{className:"drop-zone__content-icon"},e.props.icon),v.a.createElement("span",{className:"drop-zone__content-text"},t)))})),e}return i()(o,[{key:"componentDidMount",value:function(){this.dragEnterNodes=[],window.addEventListener("dragover",this.preventDefault),window.addEventListener("drop",this.onDrop),window.addEventListener("dragenter",this.toggleDraggingOverDocument),window.addEventListener("dragleave",this.toggleDraggingOverDocument),window.addEventListener("mouseup",this.resetDragState)}},{key:"componentDidUpdate",value:function(e,t){t.isDraggingOverDocument!==this.state.isDraggingOverDocument&&this.toggleMutationObserver()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("dragover",this.preventDefault),window.removeEventListener("drop",this.onDrop),window.removeEventListener("dragenter",this.toggleDraggingOverDocument),window.removeEventListener("dragleave",this.toggleDraggingOverDocument),window.removeEventListener("mouseup",this.resetDragState),this.disconnectMutationObserver()}},{key:"render",value:function(){var e=R()("drop-zone",this.props.className,{"is-active":this.state.isDraggingOverDocument||this.state.isDraggingOverElement,"is-dragging-over-document":this.state.isDraggingOverDocument,"is-dragging-over-element":this.state.isDraggingOverElement,"is-full-screen":this.props.fullScreen}),t=v.a.createElement("div",{ref:this.zoneRef,className:e},this.renderContent());return this.props.fullScreen?v.a.createElement(O.a,null,t):t}}]),o}(v.a.Component));h()(N,"propTypes",{className:y.a.string,fullScreen:y.a.bool,icon:y.a.node,onDrop:y.a.func,onVerifyValidTransfer:y.a.func,onFilesDrop:y.a.func,textLabel:A.a,translate:y.a.func,showDropZone:y.a.func.isRequired,hideDropZone:y.a.func.isRequired,dropZoneName:y.a.string}),h()(N,"defaultProps",{className:null,onDrop:_.a,onVerifyValidTransfer:function(){return!0},onFilesDrop:_.a,fullScreen:!1,icon:v.a.createElement(S.a,{icon:"cloud-upload",size:48}),translate:k.a,dropZoneName:null});var T={showDropZone:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return{type:I.vd,dropZoneName:e}},hideDropZone:function(e){return{type:I.ud,dropZoneName:e}}};t.a=Object(w.c)(null,T)(Object(j.c)(N))},"./components/drop-zone/style.scss":function(e,t,o){},"./components/file-picker/index.jsx":function(e,t,o){"use strict";o.d(t,"a",(function(){return w}));var n=o("../node_modules/@babel/runtime/helpers/classCallCheck.js"),a=o.n(n),s=o("../node_modules/@babel/runtime/helpers/createClass.js"),i=o.n(s),r=o("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),l=o.n(r),d=o("../node_modules/@babel/runtime/helpers/inherits.js"),c=o.n(d),p=o("../node_modules/@babel/runtime/helpers/createSuper.js"),u=o.n(p),m=o("../node_modules/prop-types/index.js"),h=o.n(m),g=o("../node_modules/react/index.js"),f=o.n(g),b=o("../node_modules/lodash-es/assign.js"),v=o("../node_modules/lodash-es/noop.js"),E=o("../node_modules/component-file-picker/index.js"),y=o.n(E),w=function(e){c()(o,e);var t=u()(o);function o(e){var n;return a()(this,o),(n=t.call(this,e)).showPicker=n.showPicker.bind(l()(n)),n}return i()(o,[{key:"showPicker",value:function(){this.props.onClick(),y()(Object(b.a)({},this.props),this.props.onPick)}},{key:"render",value:function(){return f.a.createElement("span",{className:"file-picker",onClick:this.showPicker},this.props.children)}}]),o}(f.a.Component);w.displayName="FilePicker",w.propTypes={multiple:h.a.bool,directory:h.a.bool,accept:h.a.string,onClick:h.a.func,onPick:h.a.func},w.defaultProps={multiple:!1,directory:!1,accept:null,onClick:v.a,onPick:v.a}},"./components/forms/form-textarea/index.jsx":function(e,t,o){"use strict";var n=o("../node_modules/@babel/runtime/helpers/extends.js"),a=o.n(n),s=o("../node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),i=o.n(s),r=o("../node_modules/react/index.js"),l=o.n(r),d=o("../node_modules/classnames/index.js"),c=o.n(d);t.a=function(e){var t=e.className,o=e.isError,n=e.isValid,s=e.children,r=i()(e,["className","isError","isValid","children"]);return l.a.createElement("textarea",a()({},r,{className:c()(t,"form-textarea",{"is-error":o,"is-valid":n})}),s)}},"./components/popover/menu.jsx":function(e,t,o){"use strict";var n=o("../node_modules/@babel/runtime/helpers/classCallCheck.js"),a=o.n(n),s=o("../node_modules/@babel/runtime/helpers/createClass.js"),i=o.n(s),r=o("../node_modules/@babel/runtime/helpers/assertThisInitialized.js"),l=o.n(r),d=o("../node_modules/@babel/runtime/helpers/inherits.js"),c=o.n(d),p=o("../node_modules/@babel/runtime/helpers/createSuper.js"),u=o.n(p),m=o("../node_modules/@babel/runtime/helpers/defineProperty.js"),h=o.n(m),g=o("../node_modules/react/index.js"),f=o.n(g),b=o("../node_modules/prop-types/index.js"),v=o.n(b),E=o("./components/popover/index.jsx"),y=function(e){return"HR"===e.tagName},w=function(e){c()(o,e);var t=u()(o);function o(){var e;a()(this,o);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return e=t.call.apply(t,[this].concat(s)),h()(l()(e),"menu",f.a.createRef()),h()(l()(e),"_setPropsOnChild",(function(t){if(null==t)return t;var o=t.props,n=o.action,a=o.onClick;return f.a.cloneElement(t,{action:null,onClick:function(t){a&&a(t),e._onClose(n)}})})),h()(l()(e),"_onShow",(function(){var t=e.menu.current;e._previouslyFocusedElement=document.activeElement,t&&t.focus()})),h()(l()(e),"_getClosestSibling",(function(t){var o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.menu.current,a=n.firstChild,s=n.lastChild;if(o||(a=n.lastChild,s=n.firstChild),t===n)return a;var i=t[o?"nextSibling":"previousSibling"],r=i||s;return y(r)?e._getClosestSibling(r,o):r})),h()(l()(e),"_onKeyDown",(function(t){var o,n=t.target,a=!1;switch(t.keyCode){case 9:e.props.onClose(),a=!0;break;case 38:o=e._getClosestSibling(n,!1),a=!0;break;case 40:o=e._getClosestSibling(n,!0),a=!0}o&&o.focus(),a&&t.preventDefault()})),h()(l()(e),"_onClose",(function(t){e._previouslyFocusedElement&&(e._previouslyFocusedElement.focus(),e._previouslyFocusedElement=null),e.props.onClose&&e.props.onClose(t)})),e}return i()(o,[{key:"componentWillUnmount",value:function(){this._previouslyFocusedElement=null}},{key:"render",value:function(){var e=this.props,t=e.popoverComponent,o=e.autoPosition,n=e.className,a=e.context,s=e.customPosition,i=e.isVisible,r=e.popoverTitle,l=e.position;return f.a.createElement(t,{onClose:this._onClose,onShow:this._onShow,autoPosition:o,className:n,context:a,customPosition:s,isVisible:i,popoverTitle:r,position:l},f.a.createElement("div",{ref:this.menu,role:"menu",className:"popover__menu",onKeyDown:this._onKeyDown,tabIndex:"-1"},f.a.Children.map(this.props.children,this._setPropsOnChild,this)))}}]),o}(g.Component);h()(w,"propTypes",{autoPosition:v.a.bool,isVisible:v.a.bool.isRequired,onClose:v.a.func.isRequired,position:v.a.string,className:v.a.string,popoverComponent:v.a.elementType,popoverTitle:v.a.string,customPosition:v.a.object}),h()(w,"defaultProps",{autoPosition:!0,position:"top",popoverComponent:E.a}),t.a=w},"./lib/media/utils/url.js":function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));var n=o("../packages/photon/dist/esm/index.js"),a=o("./lib/resize-image-url/index.js");function s(e,t){if(e){if(e.transient)return e.URL;if(e.URL)return(t=t||{}).photon?t.maxWidth?Object(n.a)(e.URL,{width:t.maxWidth}):t.resize?Object(n.a)(e.URL,{resize:t.resize}):Object(n.a)(e.URL):e.thumbnails&&t.size in e.thumbnails?e.thumbnails[t.size]:t.maxWidth?Object(a.a)(e.URL,{w:t.maxWidth}):t.resize?Object(a.a)(e.URL,{resize:t.resize}):e.URL}}},"./state/drop-zone/init.js":function(e,t,o){"use strict";var n=o("./state/redux-store.ts"),a=o("../node_modules/@babel/runtime/helpers/defineProperty.js"),s=o.n(a),i=o("../node_modules/@babel/runtime/helpers/objectSpread2.js"),r=o.n(i),l=o("./state/action-types.js"),d=o("./state/utils/without-persistence.js"),c=o("./state/utils/reducer-utils.js"),p=o("./state/utils/with-storage-key.js"),u=Object(d.a)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.vd:var o=t.dropZoneName;return r()(r()({},e),{},s()({},o,!0));case l.ud:var n=t.dropZoneName;return r()(r()({},e),{},s()({},n,!1))}return e})),m=Object(c.a)({isVisible:u}),h=Object(p.a)("dropZone",m);Object(n.a)(["dropZone"],h)}}]);